<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQL | Ailzr's Blog</title><meta name="author" content="Ailzr,ailzr@outlook.com"><meta name="copyright" content="Ailzr"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="# MySQL 概述 数据库概念： 数据库：存储数据的仓库，数据是有组织的进行存储，英文：DataBase (DB) 数据库管理系统：操纵和管理数据库的大型软件，英文：DataBase Management System (DBMS) SQL：操作关系型数据库的编程语言，定义了一套操作关系型数据库的统一标准，英文：Structured Query Language (SQL) 启动与停止： 12n">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL">
<meta property="og:url" content="https://www.ailzr.com/2023/03/31/MySQL/index.html">
<meta property="og:site_name" content="Ailzr&#39;s Blog">
<meta property="og:description" content="# MySQL 概述 数据库概念： 数据库：存储数据的仓库，数据是有组织的进行存储，英文：DataBase (DB) 数据库管理系统：操纵和管理数据库的大型软件，英文：DataBase Management System (DBMS) SQL：操作关系型数据库的编程语言，定义了一套操作关系型数据库的统一标准，英文：Structured Query Language (SQL) 启动与停止： 12n">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.ailzr.com/assets/MySQL_Cover.png">
<meta property="article:published_time" content="2023-03-31T03:44:12.000Z">
<meta property="article:modified_time" content="2023-09-02T07:45:03.691Z">
<meta property="article:author" content="Ailzr">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.ailzr.com/assets/MySQL_Cover.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://www.ailzr.com/2023/03/31/MySQL/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-02 15:45:03'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Ailzr's Blog"><img class="site-icon" src="/img/favicon.ico#%20image"/><span class="site-name">Ailzr's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">MySQL</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-31T03:44:12.000Z" title="发表于 2023-03-31 11:44:12">2023-03-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-09-02T07:45:03.691Z" title="更新于 2023-09-02 15:45:03">2023-09-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="leancloud_visitors" id="/2023/03/31/MySQL/" data-flag-title="MySQL"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span class="leancloud-visitors-count"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="mysql概述"><a class="markdownIt-Anchor" href="#mysql概述">#</a> MySQL 概述</h1>
<p>数据库概念：</p>
<p>数据库：<strong>存储数据的仓库，数据是有组织的进行存储</strong>，英文：DataBase (DB)</p>
<p>数据库管理系统：操纵和管理数据库的大型软件，英文：DataBase Management System (DBMS)</p>
<p>SQL：<strong>操作关系型数据库的编程语言，定义了一套操作关系型数据库的统一标准</strong>，英文：Structured Query Language (SQL)</p>
<p>启动与停止：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net start mysql80 #启动</span><br><span class="line">net stop mysql80 #停止</span><br></pre></td></tr></table></figure>
<p><strong>关系型数据库 (RDBMS):</strong></p>
<p>概念：建立在关系模型基础上，由多张相互链接的二维表组成的数据库。(类似于 excel 表格)</p>
<p>特点：</p>
<p>1. 使用表存储数据，格式统一，便于维护</p>
<p>2. 使用 SQL 语言操作，标准统一，使用方便</p>
<h1 id="sql语言"><a class="markdownIt-Anchor" href="#sql语言">#</a> <mark>SQL 语言</mark></h1>
<p>使用下面指令登录用户：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -u userName -p</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">其中-u为指定user</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-p为password，使用密码登录</span></span><br></pre></td></tr></table></figure>
<h2 id="基础内容"><a class="markdownIt-Anchor" href="#基础内容">#</a> 基础内容</h2>
<p>SQL 语句可以单行或多行书写，以<strong>分号结尾</strong>。</p>
<p>MySQL 数据库的 SQL 语句不区分大小写，关键字建议使用大写。</p>
<p>注释：单行使用–或 #(MySQL 特有)，多行使用 /**/</p>
<h2 id="sql分类"><a class="markdownIt-Anchor" href="#sql分类">#</a> SQL 分类</h2>
<table>
<thead>
<tr>
<th style="text-align:center">分类</th>
<th style="text-align:center">全称</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">DDL</td>
<td style="text-align:center">Data Definition Language</td>
<td style="text-align:center">数据定义语言，用来定义数据库对象 (数据库，表，字段)</td>
</tr>
<tr>
<td style="text-align:center">DML</td>
<td style="text-align:center">Data Manipulation Language</td>
<td style="text-align:center">数据操作语言，用来对数据库表种的数据进行增删改</td>
</tr>
<tr>
<td style="text-align:center">DQL</td>
<td style="text-align:center">Data Query Language</td>
<td style="text-align:center">数据查询语言，用来查询数据库中表的记录</td>
</tr>
<tr>
<td style="text-align:center">DCL</td>
<td style="text-align:center">Data Control Language</td>
<td style="text-align:center">数据控制语言，用来创建数据库用户、控制数据库的访问权限</td>
</tr>
</tbody>
</table>
<h2 id="ddl数据定义语言"><a class="markdownIt-Anchor" href="#ddl数据定义语言">#</a> DDL (数据定义语言)</h2>
<h3 id="ddl-数据库操作"><a class="markdownIt-Anchor" href="#ddl-数据库操作">#</a> DDL - 数据库操作</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#[]中是可写，可不写的内容 </span><br><span class="line">#查询</span><br><span class="line"><span class="keyword">show</span> databases; #查询所有数据库</span><br><span class="line"><span class="keyword">select</span> database(); #查询当前数据库</span><br><span class="line">#创建</span><br><span class="line"><span class="keyword">create</span> database [if <span class="keyword">not</span> <span class="keyword">exists</span>] 数据库名 [<span class="keyword">default</span> charset 字符集] [<span class="keyword">collate</span> 排序规则];</span><br><span class="line">#删除</span><br><span class="line"><span class="keyword">drop</span> database [if <span class="keyword">exists</span>] 数据库名;</span><br><span class="line">#使用，切换数据库</span><br><span class="line">use 数据库名;</span><br></pre></td></tr></table></figure>
<h3 id="数据类型"><a class="markdownIt-Anchor" href="#数据类型">#</a> 数据类型</h3>
<p><strong>数值类型：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">大小</th>
<th style="text-align:center">有符号范围</th>
<th style="text-align:center">无符号范围</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">TINYINT</td>
<td style="text-align:center">1byte</td>
<td style="text-align:center">-2^7,2^7-1</td>
<td style="text-align:center">0,2^8-1</td>
<td style="text-align:center">微整型</td>
</tr>
<tr>
<td style="text-align:center">SMALLINT</td>
<td style="text-align:center">2bytes</td>
<td style="text-align:center">-2^15,2^15-1</td>
<td style="text-align:center">0,2^16-1</td>
<td style="text-align:center">小整型</td>
</tr>
<tr>
<td style="text-align:center">MEDIUMINT</td>
<td style="text-align:center">3bytes</td>
<td style="text-align:center">-2^23,2^23-1</td>
<td style="text-align:center">0,2^24-1</td>
<td style="text-align:center">中整型</td>
</tr>
<tr>
<td style="text-align:center">INT 或 INTEGER</td>
<td style="text-align:center">4bytes</td>
<td style="text-align:center">-2^31,2^31-1</td>
<td style="text-align:center">0,2^32-1</td>
<td style="text-align:center">整型</td>
</tr>
<tr>
<td style="text-align:center">BIGINT</td>
<td style="text-align:center">8bytes</td>
<td style="text-align:center">-2^63,2^63-1</td>
<td style="text-align:center">0,2^64-1</td>
<td style="text-align:center">长整型</td>
</tr>
<tr>
<td style="text-align:center">FLOAT</td>
<td style="text-align:center">4bytes</td>
<td style="text-align:center">-3.402823466 E+38,3.402823466351 E+38</td>
<td style="text-align:center">0 和 1.175494351 E-38, 3.402823466 E+38</td>
<td style="text-align:center">单精度浮点型</td>
</tr>
<tr>
<td style="text-align:center">DOUBLE</td>
<td style="text-align:center">8bytes</td>
<td style="text-align:center">-1.7976931348623157 E+308, 1.7976931348623157 E+308</td>
<td style="text-align:center">0 和 2.2250738585072014 E-308, 1.7976931348623157 E+308</td>
<td style="text-align:center">双精度浮点型</td>
</tr>
<tr>
<td style="text-align:center">DECIMAL</td>
<td style="text-align:center"></td>
<td style="text-align:center">依赖于 M (精度) 和 D (标度) 的值</td>
<td style="text-align:center">依赖于 M (精度) 和 D (标度) 的值</td>
<td style="text-align:center">小数值 (精确定点数)</td>
</tr>
</tbody>
</table>
<p>M：指数值总位数，D：指小数位数</p>
<p><strong>字符串类型：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">大小</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CHAR</td>
<td style="text-align:center">0-255 bytes</td>
<td style="text-align:center">定长字符串</td>
</tr>
<tr>
<td style="text-align:center">VARCHAR</td>
<td style="text-align:center">0-65535 bytes</td>
<td style="text-align:center">变长字符串</td>
</tr>
<tr>
<td style="text-align:center">TINYBLOB</td>
<td style="text-align:center">0-255 bytes</td>
<td style="text-align:center">不超过 255 个字符的二进制数据</td>
</tr>
<tr>
<td style="text-align:center">TINYTEXT</td>
<td style="text-align:center">0-255 bytes</td>
<td style="text-align:center">短文本字符串</td>
</tr>
<tr>
<td style="text-align:center">BLOB</td>
<td style="text-align:center">0-65535 bytes</td>
<td style="text-align:center">二进制形势的长文本数据</td>
</tr>
<tr>
<td style="text-align:center">TEXT</td>
<td style="text-align:center">0-65535 bytes</td>
<td style="text-align:center">长文本数据</td>
</tr>
<tr>
<td style="text-align:center">MEDIUMBLOB</td>
<td style="text-align:center">0-2^24 - 1 bytes</td>
<td style="text-align:center">二进制形势的中等长度文本数据</td>
</tr>
<tr>
<td style="text-align:center">MEDIUMTEXT</td>
<td style="text-align:center">0-2^24 - 1 bytes</td>
<td style="text-align:center">中等长度文本数据</td>
</tr>
<tr>
<td style="text-align:center">LONGBLOB</td>
<td style="text-align:center">0-2^32 - 1 bytes</td>
<td style="text-align:center">二进制形势的极大文本数据</td>
</tr>
<tr>
<td style="text-align:center">LONGTEXT</td>
<td style="text-align:center">0-2^32 - 1 bytes</td>
<td style="text-align:center">极大文本数据</td>
</tr>
</tbody>
</table>
<p><strong>日期类型：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">大小</th>
<th style="text-align:center">范围</th>
<th style="text-align:center">格式</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">DATE</td>
<td style="text-align:center">3</td>
<td style="text-align:center">1000-01-01 至 9999-12-31</td>
<td style="text-align:center">YYYY-MM-DD</td>
<td style="text-align:center">日期值</td>
</tr>
<tr>
<td style="text-align:center">TIME</td>
<td style="text-align:center">3</td>
<td style="text-align:center">-838:59:59 至 838:59:59</td>
<td style="text-align:center">HH:MM:SS</td>
<td style="text-align:center">时间值或持续时间</td>
</tr>
<tr>
<td style="text-align:center">YEAR</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1901 至 2155</td>
<td style="text-align:center">YYYY</td>
<td style="text-align:center">年份值</td>
</tr>
<tr>
<td style="text-align:center">DATETIME</td>
<td style="text-align:center">8</td>
<td style="text-align:center">1000-01-01 00:00:00 至 9999-12-31 23:59:59</td>
<td style="text-align:center">YYYY-MM-DD HH:MM:SS</td>
<td style="text-align:center">混合日期和时间值</td>
</tr>
<tr>
<td style="text-align:center">TIMESTAMP</td>
<td style="text-align:center">4</td>
<td style="text-align:center">1970-01-01 00:00:01 至 2038-01-19 03:14:07</td>
<td style="text-align:center">YYYY-MM-DD HH:MM:SS</td>
<td style="text-align:center">混合日期和时间值，时间戳</td>
</tr>
</tbody>
</table>
<h3 id="ddl-表查询"><a class="markdownIt-Anchor" href="#ddl-表查询">#</a> DDL - 表查询</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#查询当前数据库所有表</span><br><span class="line"><span class="keyword">show</span> tables;</span><br><span class="line">#查询表结构</span><br><span class="line"><span class="keyword">desc</span> 表名;</span><br><span class="line">#查询指定表的建表语句</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></table></figure>
<h3 id="ddl-表创建"><a class="markdownIt-Anchor" href="#ddl-表创建">#</a> DDL - 表创建</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">    字段<span class="number">1</span> 字段<span class="number">1</span>类型[comment 字段<span class="number">1</span>注释],#<span class="keyword">sql</span>中的字符串类型是<span class="type">varchar</span>(size)</span><br><span class="line">    字段<span class="number">2</span> 字段<span class="number">2</span>类型[comment 字段<span class="number">2</span>注释],</span><br><span class="line">    字段<span class="number">3</span> 字段<span class="number">3</span>类型[comment 字段<span class="number">3</span>注释],</span><br><span class="line">    ...</span><br><span class="line">    字段n 字段n类型[comment 字段n注释]</span><br><span class="line">)[comment 表注释];</span><br><span class="line">#使用案例</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_usr(</span><br><span class="line">	id <span class="type">int</span> comment <span class="string">&#x27;编号&#x27;</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">50</span>) comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    age <span class="type">int</span> comment <span class="string">&#x27;年龄&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;用户表&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="ddl-表修改"><a class="markdownIt-Anchor" href="#ddl-表修改">#</a> DDL - 表修改</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#添加字段</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> 字段名 字段类型(长度) [comment 注释][约束];</span><br><span class="line">#修改数据类型</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 modify 字段名 新数据类型(长度);</span><br><span class="line">#修改字段名和字段类型</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 change 旧字段名 新字段名 字段类型(长度) [comment 注释][约束];</span><br><span class="line">#删除字段</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> 字段名;</span><br><span class="line">#修改表名</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 rename <span class="keyword">to</span> 新表名;</span><br><span class="line">#删除表</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> [if <span class="keyword">exists</span>] 表名;</span><br><span class="line">#清空表数据</span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></table></figure>
<h2 id="dml数据操作语言"><a class="markdownIt-Anchor" href="#dml数据操作语言">#</a> DML (数据操作语言)</h2>
<p>DML (Data Manipulation Language)，数据操作语言，用来对数据库中表的数据记录进行增删改操作</p>
<p>添加数据 (INSERT)</p>
<p>修改数据 (UPDATE)</p>
<p>删除数据 (DELETE)</p>
<h3 id="dml-添加数据"><a class="markdownIt-Anchor" href="#dml-添加数据">#</a> DML - 添加数据</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#给指定字段添加数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名(字段名<span class="number">1</span>,字段名<span class="number">2</span>,...) <span class="keyword">VALUES</span>(值<span class="number">1</span>,值<span class="number">2</span>,...);</span><br><span class="line">#给全部字段添加数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名 <span class="keyword">VALUES</span>(值<span class="number">1</span>,值<span class="number">2</span>,...);</span><br><span class="line">#批量添加数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名(字段名<span class="number">1</span>,字段名<span class="number">2</span>,...) <span class="keyword">VALUES</span>(值<span class="number">1</span>,值<span class="number">2</span>,...),(值<span class="number">1</span>,值<span class="number">2</span>,...),(值<span class="number">1</span>,值<span class="number">2</span>,...);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名 <span class="keyword">VALUES</span>(值<span class="number">1</span>,值<span class="number">2</span>,...),(值<span class="number">1</span>,值<span class="number">2</span>,...),(值<span class="number">1</span>,值<span class="number">2</span>,...);</span><br></pre></td></tr></table></figure>
<h3 id="dml-修改数据"><a class="markdownIt-Anchor" href="#dml-修改数据">#</a> DML - 修改数据</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> 表名 <span class="keyword">SET</span> 字段名<span class="number">1</span> <span class="operator">=</span> 值<span class="number">1</span>, 字段名<span class="number">2</span> <span class="operator">=</span> 值<span class="number">2</span>, ...[<span class="keyword">WHERE</span> 条件]</span><br><span class="line">#如果不写<span class="keyword">where</span>条件，则修改作用于整张表</span><br></pre></td></tr></table></figure>
<h3 id="dml-删除数据"><a class="markdownIt-Anchor" href="#dml-删除数据">#</a> DML - 删除数据</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表名 [<span class="keyword">WHERE</span> 条件]</span><br><span class="line">#如果不写<span class="keyword">where</span>条件，则删除整张表的所有数据</span><br></pre></td></tr></table></figure>
<h2 id="dql数据查询语言"><a class="markdownIt-Anchor" href="#dql数据查询语言">#</a> DQL (数据查询语言)</h2>
<p>DQL (Data Query Language) 数据查询语言，用来查询数据库中表的记录。</p>
<p>查询关键字 (SELECT)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#基础查询</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	字段列表</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	表名列表</span><br><span class="line">#条件查询</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	条件列表</span><br><span class="line">#分组查询、通常配合聚合函数使用</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	分组字段列表</span><br><span class="line"><span class="keyword">HAVING</span></span><br><span class="line">	分组后条件列表</span><br><span class="line">#排序查询</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">	排序字段列表</span><br><span class="line">#分页查询</span><br><span class="line">LIMIT</span><br><span class="line">	分页参数</span><br><span class="line">#DQL的执行顺序为：</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line"><span class="keyword">HAVING</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">LIMIT</span><br></pre></td></tr></table></figure>
<h3 id="dql-基础查询"><a class="markdownIt-Anchor" href="#dql-基础查询">#</a> DQL - 基础查询</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#查询多个字段</span><br><span class="line"><span class="keyword">SELECT</span> 字段<span class="number">1</span>,字段<span class="number">2</span>,字段<span class="number">3.</span>.. <span class="keyword">FROM</span> 表名;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 表名;</span><br><span class="line">#设置别名</span><br><span class="line"><span class="keyword">SELECT</span> 字段<span class="number">1</span> [<span class="keyword">AS</span> 别名<span class="number">1</span>],字段<span class="number">2</span> [<span class="keyword">AS</span> 别名<span class="number">2</span>]... <span class="keyword">FROM</span> 表名;</span><br><span class="line">#去除返回结果中的重复记录</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> 字段列表 <span class="keyword">FROM</span> 表名;</span><br></pre></td></tr></table></figure>
<h3 id="dql-条件查询"><a class="markdownIt-Anchor" href="#dql-条件查询">#</a> DQL - 条件查询</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#语法</span><br><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表名 <span class="keyword">WHERE</span> 条件列表;</span><br><span class="line">#条件</span><br><span class="line">#可以使用比较运算符和逻辑运算符、比较运算符同C</span><br><span class="line">#MySQL特有：</span><br><span class="line"><span class="keyword">BETWEEN</span> ... <span class="keyword">AND</span> ...#在某个范围之内，包含最小值与最大值，<span class="keyword">between</span>后是最小值，不能互换</span><br><span class="line"><span class="keyword">IN</span>(...)#在<span class="keyword">in</span>之后的列表中的值，多选一</span><br><span class="line"><span class="keyword">LIKE</span> 占位符#模糊匹配（_匹配单个字符，<span class="operator">%</span>匹配任意字符）</span><br><span class="line"><span class="keyword">IS</span> <span class="keyword">NULL</span>#是<span class="keyword">NULL</span></span><br><span class="line"></span><br><span class="line">#mysql中判断等于的符号是<span class="operator">=</span>，而不是<span class="operator">=</span><span class="operator">=</span></span><br><span class="line"><span class="operator">&lt;&gt;</span> #相当于 <span class="operator">!=</span></span><br><span class="line"><span class="keyword">AND</span> #相当于 <span class="operator">&amp;&amp;</span></span><br><span class="line"><span class="keyword">OR</span> #相当于 <span class="operator">||</span></span><br><span class="line"><span class="keyword">NOT</span> #相当于 <span class="operator">!</span></span><br></pre></td></tr></table></figure>
<h3 id="dql-聚合函数"><a class="markdownIt-Anchor" href="#dql-聚合函数">#</a> DQL - 聚合函数</h3>
<p>聚合函数：将一列数据作为一个整体，进行纵向计算</p>
<p>常见聚合函数：</p>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">count</td>
<td style="text-align:center">统计数量</td>
</tr>
<tr>
<td style="text-align:center">max</td>
<td style="text-align:center">最大值</td>
</tr>
<tr>
<td style="text-align:center">min</td>
<td style="text-align:center">最小值</td>
</tr>
<tr>
<td style="text-align:center">avg</td>
<td style="text-align:center">平均值</td>
</tr>
<tr>
<td style="text-align:center">sum</td>
<td style="text-align:center">求和</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#注意：<span class="keyword">NULL</span>不参与聚合函数的计算</span><br><span class="line">#语法</span><br><span class="line"><span class="keyword">SELECT</span> 聚合函数(字段列表) <span class="keyword">FROM</span> 表名;</span><br></pre></td></tr></table></figure>
<h3 id="dql-分组查询"><a class="markdownIt-Anchor" href="#dql-分组查询">#</a> DQL - 分组查询</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#语法</span><br><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表名 [<span class="keyword">WHERE</span> 条件] <span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组字段名 [<span class="keyword">HAVING</span> 分组后过滤条件];</span><br><span class="line">#<span class="keyword">where</span>和<span class="keyword">having</span>的区别</span><br><span class="line">#执行时机不同：<span class="keyword">where</span>是分组之前进行过滤，不满足<span class="keyword">where</span>条件，不参与分组，而<span class="keyword">having</span>是分组之后对结果过滤</span><br><span class="line">#判断条件不同：<span class="keyword">where</span>不能对聚合函数进行判断，而<span class="keyword">having</span>可以</span><br><span class="line">#执行顺序：<span class="keyword">where</span> <span class="operator">&gt;</span> 聚合函数 <span class="operator">&gt;</span> <span class="keyword">having</span></span><br></pre></td></tr></table></figure>
<h3 id="dql-排序查询"><a class="markdownIt-Anchor" href="#dql-排序查询">#</a> DQL - 排序查询</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#语法</span><br><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表名 <span class="keyword">ORDER</span> <span class="keyword">BY</span> 字段<span class="number">1</span> 排序方式<span class="number">1</span>, 字段<span class="number">2</span> 排序方式<span class="number">2</span>;</span><br><span class="line">#排序方式：</span><br><span class="line">#<span class="keyword">ASC</span>：升序(默认)</span><br><span class="line">#<span class="keyword">DESC</span>：降序</span><br></pre></td></tr></table></figure>
<h3 id="dql-分页查询"><a class="markdownIt-Anchor" href="#dql-分页查询">#</a> DQL - 分页查询</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#语法</span><br><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表名 LIMIT 起始索引,查询记录数;</span><br><span class="line">#注意：</span><br><span class="line">#起始索引从<span class="number">0</span>开始，起始索引<span class="operator">=</span>(查询页码<span class="number">-1</span>) <span class="operator">*</span> 每页显示记录数。起始索引即起始数据的下标</span><br><span class="line">#分页查询是数据库的方言，不同数据库有不同的实现，MySQL中是LIMIT</span><br><span class="line">#如果查询的是第一页数据，起始索引可以省略，直接简写为LIMIT <span class="number">10</span></span><br></pre></td></tr></table></figure>
<h2 id="dcl数据控制语言"><a class="markdownIt-Anchor" href="#dcl数据控制语言">#</a> DCL (数据控制语言)</h2>
<p>DCL (Data Control Language) 数据控制语言，用来管理数据库用户、控制数据库的访问权限</p>
<h3 id="dcl-管理用户"><a class="markdownIt-Anchor" href="#dcl-管理用户">#</a> DCL - 管理用户</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#查询用户</span><br><span class="line">USE mysql;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">#创建用户</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;密码&#x27;</span>;</span><br><span class="line">#修改用户密码</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;新密码&#x27;</span>;</span><br><span class="line">#删除用户</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="dcl-权限控制"><a class="markdownIt-Anchor" href="#dcl-权限控制">#</a> DCL - 权限控制</h3>
<table>
<thead>
<tr>
<th style="text-align:center">权限</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ALL, ALL PRIVILEGES</td>
<td style="text-align:center">所有权限</td>
</tr>
<tr>
<td style="text-align:center">SELECT</td>
<td style="text-align:center">查询数据</td>
</tr>
<tr>
<td style="text-align:center">INSERT</td>
<td style="text-align:center">插入数据</td>
</tr>
<tr>
<td style="text-align:center">UPDATE</td>
<td style="text-align:center">修改数据</td>
</tr>
<tr>
<td style="text-align:center">DELETE</td>
<td style="text-align:center">删除数据</td>
</tr>
<tr>
<td style="text-align:center">ALTER</td>
<td style="text-align:center">修改表</td>
</tr>
<tr>
<td style="text-align:center">DROP</td>
<td style="text-align:center">删除数据库 / 表 / 视图</td>
</tr>
<tr>
<td style="text-align:center">CREATE</td>
<td style="text-align:center">创建数据库 / 表</td>
</tr>
</tbody>
</table>
<p>其他权限描述及含义，可以直接参考官方文档</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#查询权限</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br><span class="line">#授予权限</span><br><span class="line"><span class="keyword">GRANT</span> 权限列表 <span class="keyword">ON</span> 数据库名.表名 <span class="keyword">TO</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br><span class="line">#撤销权限</span><br><span class="line"><span class="keyword">REVOKE</span> 权限列表 <span class="keyword">ON</span> 数据库名.表名 <span class="keyword">FROM</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h1 id="mysql内置函数"><a class="markdownIt-Anchor" href="#mysql内置函数">#</a> MySQL 内置函数</h1>
<h2 id="字符串函数"><a class="markdownIt-Anchor" href="#字符串函数">#</a> 字符串函数</h2>
<p>MySQL 中内置了许多字符串函数，常用的几个如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CONCAT(S1, S2, …, Sn)</td>
<td style="text-align:center">字符串拼接，将 S1，S2，…，Sn 拼接成一个字符串</td>
</tr>
<tr>
<td style="text-align:center">LOWER(str)</td>
<td style="text-align:center">将字符串 str 全部转为小写</td>
</tr>
<tr>
<td style="text-align:center">UPPER(str)</td>
<td style="text-align:center">将字符串 str 全部转为大写</td>
</tr>
<tr>
<td style="text-align:center">LPAD(str, n, pad)</td>
<td style="text-align:center">左填充，用字符串 pad 对 str 的左边进行填充，直到字符串长度为 n</td>
</tr>
<tr>
<td style="text-align:center">RPAD(str, n, pad)</td>
<td style="text-align:center">右填充，用字符串 pad 对 str 的右边进行填充，直到字符串长度为 n</td>
</tr>
<tr>
<td style="text-align:center">TRIM(str)</td>
<td style="text-align:center">去掉字符串头部和尾部的空格</td>
</tr>
<tr>
<td style="text-align:center">SUBSTRING(str, start, len)</td>
<td style="text-align:center">返回字符串 str 从 start 位置开始的 len 个长度的字符串 (索引从 1 开始)</td>
</tr>
</tbody>
</table>
<h2 id="数值函数"><a class="markdownIt-Anchor" href="#数值函数">#</a> 数值函数</h2>
<p>MySQL 中几个常用的数值函数：</p>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CEIL(x)</td>
<td style="text-align:center">向上取整</td>
</tr>
<tr>
<td style="text-align:center">FLOOR(x)</td>
<td style="text-align:center">向下取整</td>
</tr>
<tr>
<td style="text-align:center">MOD(x, y)</td>
<td style="text-align:center">返回 x/y 的模</td>
</tr>
<tr>
<td style="text-align:center">RAND()</td>
<td style="text-align:center">返回 0~1 内的随机数</td>
</tr>
<tr>
<td style="text-align:center">ROUND(x, y)</td>
<td style="text-align:center">求参数 x 的四舍五入的值，保留 y 位小数</td>
</tr>
</tbody>
</table>
<h2 id="日期函数"><a class="markdownIt-Anchor" href="#日期函数">#</a> 日期函数</h2>
<p>MySQL 中几个常用的日期函数：</p>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CURDATE()</td>
<td style="text-align:center">返回当前日期</td>
</tr>
<tr>
<td style="text-align:center">CURTIME()</td>
<td style="text-align:center">返回当前时间</td>
</tr>
<tr>
<td style="text-align:center">NOW()</td>
<td style="text-align:center">返回当前日期和时间</td>
</tr>
<tr>
<td style="text-align:center">YEAR(date)</td>
<td style="text-align:center">获取指定 date 的年份</td>
</tr>
<tr>
<td style="text-align:center">MONTH(date)</td>
<td style="text-align:center">获取指定 date 的月份</td>
</tr>
<tr>
<td style="text-align:center">DAY(date)</td>
<td style="text-align:center">获取指定 date 的日期</td>
</tr>
<tr>
<td style="text-align:center">DATE_ADD(data, INTERVAL expr type)</td>
<td style="text-align:center">返回一个日期 / 时间值加上一个时间间隔 expr 后的时间值</td>
</tr>
<tr>
<td style="text-align:center">DATEDIFF(date1, date2)</td>
<td style="text-align:center">返回起始时间 date1 和结束时间 date2 之间的天数</td>
</tr>
</tbody>
</table>
<h2 id="流程函数"><a class="markdownIt-Anchor" href="#流程函数">#</a> 流程函数</h2>
<p>MySQL 中几个常用的流程函数：</p>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IF(value, t, f)</td>
<td style="text-align:center">如果 value 为 true，则返回 t，否则返回 f</td>
</tr>
<tr>
<td style="text-align:center">IFNULL(value1, value2)</td>
<td style="text-align:center">如果 value1 不为空，返回 value1，否则返回 value2</td>
</tr>
<tr>
<td style="text-align:center">CASE WHEN [val1] THEN [res1] … ELSE [default] END</td>
<td style="text-align:center">如果 val1 为 true，返回 res1，… 否则返回 default 默认值</td>
</tr>
<tr>
<td style="text-align:center">CASE [expr] WHEN [val1] THEN [res1] … ELSE [default] END</td>
<td style="text-align:center">如果 expr 的值等于 val1，返回 res1，… 否则返回 default 默认值</td>
</tr>
</tbody>
</table>
<h1 id="约束"><a class="markdownIt-Anchor" href="#约束">#</a> 约束</h1>
<ul>
<li>概念：约束时作用域表中字段上的规则，用于限制存储在表中的数据</li>
<li>目的：保证数据库中数据的正确性、有效性和完整性</li>
<li>分类：</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">约束</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">关键字</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">非空约束</td>
<td style="text-align:center">限制该字段的数据不能为 null</td>
<td style="text-align:center">NOT NULL</td>
</tr>
<tr>
<td style="text-align:center">唯一约束</td>
<td style="text-align:center">保证该字段的所有数据都是唯一、不重复的</td>
<td style="text-align:center">UNIQUE</td>
</tr>
<tr>
<td style="text-align:center">主键约束</td>
<td style="text-align:center">主键是一行数据的唯一标识，要求非空且唯一</td>
<td style="text-align:center">PRIMARY KEY</td>
</tr>
<tr>
<td style="text-align:center">默认约束</td>
<td style="text-align:center">保存数据时，如果未指定该字段的值，则采用默认值</td>
<td style="text-align:center">DEFAULT</td>
</tr>
<tr>
<td style="text-align:center">检查约束</td>
<td style="text-align:center">保证字段值满足某一个条件</td>
<td style="text-align:center">CHECK</td>
</tr>
<tr>
<td style="text-align:center">外键约束</td>
<td style="text-align:center">用来让两张表的数据之间建立连接，保证数据的一致性和完整性</td>
<td style="text-align:center">FOREIGN KEY</td>
</tr>
</tbody>
</table>
<p><strong>使用案例：</strong></p>
<p>根据需求，完成如下表结构的创建</p>
<table>
<thead>
<tr>
<th style="text-align:center">字段名</th>
<th style="text-align:center">字段含义</th>
<th style="text-align:center">字段类型</th>
<th style="text-align:center">约束条件</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">id</td>
<td style="text-align:center">ID 唯一标识</td>
<td style="text-align:center">int</td>
<td style="text-align:center">主键，并且自动增长</td>
</tr>
<tr>
<td style="text-align:center">name</td>
<td style="text-align:center">姓名</td>
<td style="text-align:center">varchar(10)</td>
<td style="text-align:center">不为空，并且唯一</td>
</tr>
<tr>
<td style="text-align:center">age</td>
<td style="text-align:center">年龄</td>
<td style="text-align:center">int</td>
<td style="text-align:center">大于 0，并且小于等于 120</td>
</tr>
<tr>
<td style="text-align:center">status</td>
<td style="text-align:center">状态</td>
<td style="text-align:center">char(1)</td>
<td style="text-align:center">如果没有指定该值，则默认为 1</td>
</tr>
<tr>
<td style="text-align:center">gender</td>
<td style="text-align:center">性别</td>
<td style="text-align:center">char(1)</td>
<td style="text-align:center">无</td>
</tr>
</tbody>
</table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">    id int primary key auto_increment comment &#x27;id主键&#x27;,</span><br><span class="line">    name varchar(10) not null unique comment &#x27;姓名&#x27;,</span><br><span class="line">    age int check ( age &gt; 0 and age &lt;= 120 ) comment &#x27;年龄&#x27;,</span><br><span class="line">    status char(1) default &#x27;1&#x27; comment &#x27;状态&#x27;,</span><br><span class="line">    gender char(1)</span><br><span class="line">)comment &#x27;用户表&#x27;;</span><br></pre></td></tr></table></figure>
<h2 id="外键约束"><a class="markdownIt-Anchor" href="#外键约束">#</a> 外键约束</h2>
<p>使用外键关联其他表时，具有外键的表被称为子表，被关联的表被称为父表。也称从表与主表。</p>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#1.创建表时直接添加外键</span><br><span class="line">create table 表名(</span><br><span class="line">	字段名 数据类型,</span><br><span class="line">    ...</span><br><span class="line">    [CONSTRAINT] [外键名称] FOREIGN KEY (外键字段名) REFERENCES 主表(主表列名);</span><br><span class="line">)</span><br><span class="line">#2.建表后再修改表，添加外键</span><br><span class="line">ALTER TABLE 表名 ADD CONSTRAINT 外键名称 FOREIGN KEY (外键字段名) REFERENCES 主表(主表列名);</span><br><span class="line">#删除外键</span><br><span class="line">ALTER TABLE 表名 DROP FOREIGN KEY 外键名称;</span><br></pre></td></tr></table></figure>
<p><strong>删除 / 更新行为：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">行为</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">NO ACTION</td>
<td style="text-align:center">当在父表中删除 / 更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除 / 更新。(与 RESTRICT 一致)</td>
</tr>
<tr>
<td style="text-align:center">RESTRICT</td>
<td style="text-align:center">当在父表中删除 / 更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除 / 更新。(与 NO ACTION 一致)</td>
</tr>
<tr>
<td style="text-align:center">CASCADE</td>
<td style="text-align:center">当在父表中删除 / 更新对应记录时，首先检查该记录是否有对应外键，如果有，则也删除 / 更新外键在子表中的记录。</td>
</tr>
<tr>
<td style="text-align:center">SET NULL</td>
<td style="text-align:center">当在父表中删除对应记录时，首先检查该记录是否有对应外键，如果有则设置子表中该外键的值为 null。(这就要求该外键允许取 null)</td>
</tr>
<tr>
<td style="text-align:center">SET DEFAULT</td>
<td style="text-align:center">父表有变更时，子表将外键列设置成一个默认的值 (innodb 不支持)</td>
</tr>
</tbody>
</table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#在创建外键时，指定外键的行为</span><br><span class="line">ALTER TABLE 表名 ADD CONSTRAINT 外键名称 FOREIGN KEY (外键字段) REFERENCES 主表名(主表列名) ON UPDATE CASCADE ON DELETE CASCADE;#ON UPDATE为更新时，ON DELETE为删除时</span><br></pre></td></tr></table></figure>
<h1 id="多表查询"><a class="markdownIt-Anchor" href="#多表查询">#</a> <mark>多表查询</mark></h1>
<p>多表关系：</p>
<p>一对多，多对多，一对一</p>
<p>一对多实现：在多的一方建立外键，指向一的一方的主键</p>
<p>多对多实现：建立第三张中间表，中间表至少包含两个外键，分别关联两方主键</p>
<p>一对一实现：在任意一方加入外键，关联另外一方的主键，并设置外键为唯一的 (UNIQUE)</p>
<h2 id="多表查询概述"><a class="markdownIt-Anchor" href="#多表查询概述">#</a> 多表查询概述</h2>
<h3 id="语法"><a class="markdownIt-Anchor" href="#语法">#</a> 语法</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select 字段名/通配符 from 表一, 表二 where 条件;</span><br><span class="line">#例如</span><br><span class="line">select * from emp, dept where emp.depe_id = dept.id;</span><br><span class="line">#如果不使用where关键字添加条件，则给出结果为笛卡尔积</span><br></pre></td></tr></table></figure>
<h3 id="多表查询分类"><a class="markdownIt-Anchor" href="#多表查询分类">#</a> 多表查询分类</h3>
<p><strong>连接查询：</strong></p>
<ul>
<li>
<p>内连接：查询 A 表与 B 表的交集部分</p>
</li>
<li>
<p>外连接：分为左外连接与右外连接</p>
</li>
</ul>
<ol>
<li>左外连接：查询左表所有数据，以及两张表交集部分数据</li>
<li>右外连接：查询右表所有数据，以及两张表交集部分数据</li>
</ol>
<ul>
<li>自连接：当前表与自身的连接查询，自连接必须使用表别名</li>
</ul>
<p><strong>子查询</strong></p>
<h2 id="连接查询"><a class="markdownIt-Anchor" href="#连接查询">#</a> 连接查询</h2>
<h3 id="内连接"><a class="markdownIt-Anchor" href="#内连接">#</a> 内连接</h3>
<p><strong>内连接查询语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#隐式内连接</span><br><span class="line">select 字段列表 from 表一, 表二 where 条件;</span><br><span class="line">#显式内连接</span><br><span class="line">select 字段列表 from 表一 [inner] join 表二 on 连接条件 ...;</span><br></pre></td></tr></table></figure>
<h3 id="外连接"><a class="markdownIt-Anchor" href="#外连接">#</a> 外连接</h3>
<p><strong>左外连接语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段列表 from 表一 left [outer] join 表二 on 条件 ...;</span><br></pre></td></tr></table></figure>
<p><strong>右外连接语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段列表 from 表二 right [outer] join 表二 on 条件 ...;</span><br></pre></td></tr></table></figure>
<h3 id="自连接"><a class="markdownIt-Anchor" href="#自连接">#</a> 自连接</h3>
<p><strong>自连接查询语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段列表 from 表A 别名A join 表A 别名B on 条件 ...;</span><br></pre></td></tr></table></figure>
<h3 id="联合查询"><a class="markdownIt-Anchor" href="#联合查询">#</a> 联合查询</h3>
<p>关键字：union、union all</p>
<p>联合查询：把多次查询的结果合并起来，形成一个新的查询结果集。</p>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select 字段列表 表A ...</span><br><span class="line">union [all]</span><br><span class="line">select 字段列表 表B ...;</span><br><span class="line">#注意，这三行是一条语句</span><br><span class="line">#使用all关键字，会将两条查询结果直接拼接</span><br><span class="line">#若不使用all，则会去除重复值</span><br><span class="line">#联合查询时， 各表的列数需要相同，且字段类型也相同</span><br></pre></td></tr></table></figure>
<h3 id="子查询嵌套查询"><a class="markdownIt-Anchor" href="#子查询嵌套查询">#</a> 子查询 (嵌套查询)</h3>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t1 where column1 = (select column1 from t2);</span><br></pre></td></tr></table></figure>
<p>其中括号内部分被称为子查询，根据子查询返回结果的不同，可以分为：</p>
<ul>
<li>标量子查询 (子查询结果为单个值)</li>
<li>列子查询 (子查询结果为一列)</li>
<li>行子查询 (子查询结果为一行)</li>
<li>表子查询 (子查询结果为多行多列)</li>
</ul>
<p>根据子查询的位置，可以分为：where 之后、from 之后、select 之后</p>
<p><strong>列子查询常用操作符：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">操作符</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IN</td>
<td style="text-align:center">在指定的集合范围之内，多选一</td>
</tr>
<tr>
<td style="text-align:center">NOT IN</td>
<td style="text-align:center">不在指定的集合范围之内</td>
</tr>
<tr>
<td style="text-align:center">ANY</td>
<td style="text-align:center">子查询返回列表中，有任意一个满足即可</td>
</tr>
<tr>
<td style="text-align:center">SOME</td>
<td style="text-align:center">与 ANY 等同，使用 SOME 的地方都可以使用 ANY</td>
</tr>
<tr>
<td style="text-align:center">ALL</td>
<td style="text-align:center">子查询返回列表的所有值都必须满足</td>
</tr>
</tbody>
</table>
<h1 id="事务"><a class="markdownIt-Anchor" href="#事务">#</a> <mark>事务</mark></h1>
<p><strong>事务</strong>是一组操作的集合，它是一个不可分割的工作单位，事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作<strong>要么同时成功，要么同时失败</strong>。</p>
<p>对于 mysql 来说，默认每一条一句都是一个事务，执行后都会默认提交。</p>
<h2 id="事务控制"><a class="markdownIt-Anchor" href="#事务控制">#</a> 事务控制</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select @@autocommit;#检查自动提交的状态，1为开启，0为关闭</span><br><span class="line">set @@autocommit = 0;#设置自动提交为0</span><br><span class="line">#在这样设置后每次提交事务都需要手动提交</span><br><span class="line"></span><br><span class="line">commit;#手动提交事务</span><br><span class="line"></span><br><span class="line">rollback;#事务提交失败时，使用该指令回滚事务</span><br></pre></td></tr></table></figure>
<p>设置自动提交的状态为 0 后，每次都需要手动提交，未免过于麻烦，所以还有其他方式使用事务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#开启事务</span><br><span class="line">start transaction;</span><br><span class="line">#或者：</span><br><span class="line">begin;</span><br><span class="line"></span><br><span class="line">#提交</span><br><span class="line">commit;</span><br><span class="line">#回滚</span><br><span class="line">rollback;</span><br></pre></td></tr></table></figure>
<p>事务控制用于操作一些必须同时完成的指令，比如银行转账时的 A 账户扣款与 B 账户加款。</p>
<h2 id="事务的四大特性"><a class="markdownIt-Anchor" href="#事务的四大特性">#</a> 事务的四大特性</h2>
<p>原子性 (Atomicity)：<strong>事务是不可分割的最小操作单元，要么全部成功，要么全部失败。</strong></p>
<p>一致性 (Consistency)：<strong>事务完成时，必须使所有的数据都保持一直状态。</strong></p>
<p>隔离性 (Isolation)：<strong>数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行。</strong></p>
<p>持久性 (Durability)：<strong>事务一旦提交或回滚，它对数据库中的数据的改变是永久的。</strong></p>
<p>被缩写为：ACID</p>
<h2 id="并发事务问题"><a class="markdownIt-Anchor" href="#并发事务问题">#</a> 并发事务问题</h2>
<p>常见并发事务问题：</p>
<table>
<thead>
<tr>
<th style="text-align:center">问题</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">脏读</td>
<td style="text-align:center">一个事务读到另外一个事务还没有提交的数据</td>
</tr>
<tr>
<td style="text-align:center">不可重复读</td>
<td style="text-align:center">一个事务先后读取同一条记录，但两次读取的数据不同，称为不可重复读</td>
</tr>
<tr>
<td style="text-align:center">幻读</td>
<td style="text-align:center">一个事务按照条件查询数据时，没有对应的数据行，但插入时，又发现这行数据已经存在</td>
</tr>
</tbody>
</table>
<p>解决方式：<strong>事务的隔离级别</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">隔离级别</th>
<th style="text-align:center">脏读</th>
<th style="text-align:center">不可重复读</th>
<th style="text-align:center">幻读</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Read uncommitted</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">Read committed</td>
<td style="text-align:center">X</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">Repeatable Read (MySQL 默认)</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">Serializable</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
</tr>
</tbody>
</table>
<p>从上到下隔离级别逐渐提高，但运行效率逐渐下降。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#查看事务隔离级别</span><br><span class="line">select @@transaction_isolation;</span><br><span class="line"></span><br><span class="line">#设置事务的隔离级别</span><br><span class="line">set [session | global] transaction isolation level &#123;隔离级别&#125;;</span><br><span class="line">#session会话级别，仅对当前客户端生效</span><br><span class="line">#global，对所有客户端生效</span><br></pre></td></tr></table></figure>
<h1 id="-分割线-基础内容到此结束"><a class="markdownIt-Anchor" href="#-分割线-基础内容到此结束">#</a> ------ 分割线 ------(基础内容到此结束)</h1>
<h1 id="存储引擎"><a class="markdownIt-Anchor" href="#存储引擎">#</a> 存储引擎</h1>
<p>存储引擎就是存储数据、建立索引、更新 / 查询数据等技术的实现方式。</p>
<p>存储引擎是基于表的，而不是基于库的，所以存储引擎也可被称为表类型。</p>
<p>MySQL 默认的存储引擎是 InnoDB。</p>
<p>创建表时，可在括号后面写上<strong> ENGINE = INNODB</strong> 来指定存储引擎，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table table_name(</span><br><span class="line">	...</span><br><span class="line">)engine = InnoDB comment [注释];</span><br><span class="line">#使用show engines;可以查看所有的存储引擎</span><br></pre></td></tr></table></figure>
<h2 id="存储引擎特点"><a class="markdownIt-Anchor" href="#存储引擎特点">#</a> 存储引擎特点</h2>
<h3 id="innodb"><a class="markdownIt-Anchor" href="#innodb">#</a> InnoDB</h3>
<p>InnoDB 是一种兼顾高可靠性和高性能的通过用存储引擎，在 MySQL5.5 之后，InnoDB 是默认的 MySQL 存储引擎。</p>
<p>特点：</p>
<ul>
<li>DML 操作遵循 ACID 模型，支持事务</li>
<li>行级锁，提高并发访问性能</li>
<li>支持外键 FOREIGN KEY 约束，保证数据的完整性和正确性</li>
</ul>
<p>文件：</p>
<p>xxx.ibd：xxx 是表名，innoDB 引擎的每张表都会对应这样一个表空间文件，存储该表的表结构 (frm、sdi)、数据和索引。参数：innodb_file_per_table</p>
<p>InnoDB 中一个页 / 块，大小为 16kb</p>
<h3 id="myisam"><a class="markdownIt-Anchor" href="#myisam">#</a> MyISAM</h3>
<p>MyISAM 是 MySQL 早期的默认存储引擎。</p>
<p>特点：</p>
<ul>
<li>不支持事务，不支持外键</li>
<li>支持表锁，不支持行锁</li>
<li>访问速度快</li>
</ul>
<p>文件：</p>
<ul>
<li>xxx.sdi：存储表结构信息</li>
<li>xxx.MYD：存储数据</li>
<li>xxx.MYI：存储索引</li>
</ul>
<h3 id="memory"><a class="markdownIt-Anchor" href="#memory">#</a> Memory</h3>
<p>Memory 引擎的表数据是存储在内存中的，由于受到硬件问题、或断电问题的影响，只能将这些表作为临时表或者缓存使用</p>
<p>特点：</p>
<ul>
<li>内存释放</li>
<li>hash 索引 (默认)</li>
</ul>
<p>文件：</p>
<p>xxx.sdi：存储表结构信息</p>
<h3 id="特点对比"><a class="markdownIt-Anchor" href="#特点对比">#</a> 特点对比</h3>
<table>
<thead>
<tr>
<th style="text-align:center">特点</th>
<th style="text-align:center">InnoDB</th>
<th style="text-align:center">MyISAM</th>
<th style="text-align:center">Memory</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">存储限制</td>
<td style="text-align:center">64TB</td>
<td style="text-align:center">有</td>
<td style="text-align:center">有</td>
</tr>
<tr>
<td style="text-align:center">事务安全</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">锁机制</td>
<td style="text-align:center">行锁</td>
<td style="text-align:center">表锁</td>
<td style="text-align:center">表锁</td>
</tr>
<tr>
<td style="text-align:center">B+tree 索引</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">Hash 索引</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">全文索引</td>
<td style="text-align:center">支持 (5.6 版本后)</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">空间使用</td>
<td style="text-align:center">高</td>
<td style="text-align:center">低</td>
<td style="text-align:center">N/A</td>
</tr>
<tr>
<td style="text-align:center">内存使用</td>
<td style="text-align:center">高</td>
<td style="text-align:center">低</td>
<td style="text-align:center">中等</td>
</tr>
<tr>
<td style="text-align:center">批量插入速度</td>
<td style="text-align:center">低</td>
<td style="text-align:center">高</td>
<td style="text-align:center">高</td>
</tr>
<tr>
<td style="text-align:center">支持外键</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
</tbody>
</table>
<h2 id="存储引擎选则"><a class="markdownIt-Anchor" href="#存储引擎选则">#</a> 存储引擎选则</h2>
<p>InnoDB：MySQL 的默认存储引擎。如果应用<strong>对事务的完整性有比较高</strong>的要求，在并<strong>发条件下要求数据的一致性</strong>，<strong>数据操作除了插入和查询之外，还包含很多的更新、删除操作</strong>，那么 InnoDB 引擎是比较合适的选择。</p>
<p>MyISAM：如果应用是以<strong>读操作和插入操作为主</strong>，只有<strong>很少的更新和删除操作</strong>，并且<strong>对事务的完整性、并发性要求不是很高</strong>，那么选择这个引擎是非常合适的。</p>
<p>Memory：将所有数据保存在内存中，访问速度快，<strong>通常用于临时表及缓存</strong>。Memory 的缺陷就是对表的大小有限制，<strong>太大的表无法缓存在内存中</strong>，而且<strong>无法保障数据的安全性</strong>。</p>
<h1 id="索引"><a class="markdownIt-Anchor" href="#索引">#</a> <mark>索引</mark></h1>
<h2 id="概述"><a class="markdownIt-Anchor" href="#概述">#</a> 概述</h2>
<p>索引 (index) 是帮助 MySQL 高效获取数据的数据结构 (有序)。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用 (指向) 数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</p>
<p><strong>优点：</strong></p>
<ul>
<li>提高数据检索的效率，降低数据库的 IO 成本</li>
<li>通过索引列对数据进行排序，降低数据排序的成本，降低 CPU 的消耗</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>索引列也需要占用空间</li>
<li>索引大大的提高了查询效率，但同时也降低了增删改 (INSERT、DELETE、UPDATE) 的效率</li>
</ul>
<h2 id="索引结构"><a class="markdownIt-Anchor" href="#索引结构">#</a> 索引结构</h2>
<p>MySQL 的索引是在存储引擎层实现的，不同的存储引擎有不同的结构，主要包含以下几种：</p>
<table>
<thead>
<tr>
<th style="text-align:center">索引结构</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">B+Tree 索引</td>
<td style="text-align:center">最常见的索引类型，大部分引擎都支持</td>
</tr>
<tr>
<td style="text-align:center">Hash 索引</td>
<td style="text-align:center">底层数据结构是用哈希表实现的，只有精确匹配索引列的查询才有效，不支持范围查询</td>
</tr>
<tr>
<td style="text-align:center">R-tree (空间索引)</td>
<td style="text-align:center">空间索引是 MyISAM 引擎的一个特殊索引类型，主要用于地理空间数据类型，通常使用较少</td>
</tr>
<tr>
<td style="text-align:center">Full-text (全文索引)</td>
<td style="text-align:center">是一种通过建立倒排索引，快速匹配文档的方式。类似于 Lucene，Solr，ES</td>
</tr>
</tbody>
<tbody>
<tr>
<td style="text-align:center">索引</td>
<td style="text-align:center">InnoDB</td>
<td>MyISAM</td>
<td>Memory</td>
</tr>
<tr>
<td style="text-align:center">:--------:</td>
<td style="text-align:center">:-------------:</td>
<td>:----:</td>
<td>:----:</td>
</tr>
<tr>
<td style="text-align:center">B+tree 索引</td>
<td style="text-align:center">支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td style="text-align:center">Hash 索引</td>
<td style="text-align:center">不支持</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td style="text-align:center">R-tree 索引</td>
<td style="text-align:center">不支持</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td style="text-align:center">Full-text</td>
<td style="text-align:center">5.6 版本之后支持</td>
<td>支持</td>
<td>不支持</td>
</tr>
</tbody>
</table>
<p><strong>B 树：</strong></p>
<p>对于 B 树，假设要存储下面一组数据：</p>
<p>234、345、23、899、1200、1234、1500、1000、123、245、12、1567、1800、1980、2000、1888、2456</p>
<p>若树的度为 5，则一个节点可以存储 4 份数据、5 个指针。</p>
<p>存储结果如下：</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305061707434.png" alt="image-20230506170709350"></p>
<p>当一个节点的数据达到 5 时，会将其从中间数据分裂，然后向上存储，且存储时数据分布会排序好。</p>
<p><strong>B + 树：</strong></p>
<p>对于 B + 树，向上裂变的同时，叶子节点中仍保存数据，并在叶子节点处建立指向其下一个兄弟节点的索引，以形成一条链表，便于区域查找。</p>
<p>假设要插入下面一组数据：</p>
<p>1000、567、234、232、890、1234、2345</p>
<p>若树的度为 5，则存储结果如下：</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305061711027.png" alt="image-20230506171133948"></p>
<p>B + 树的所有数据都会出现在叶子节点，非叶子节点仅仅起到索引数据的作用。</p>
<p>MySQL 索引数据结构对经典的 B + 树进行了优化，将原 B + 树叶子节点的单链表结构修改为了双向循环链表，示意图如下：</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305061713810.png" alt="image-20230506171358693"></p>
<p>这样的修改提高了区间访问的性能。</p>
<h2 id="索引分类"><a class="markdownIt-Anchor" href="#索引分类">#</a> 索引分类</h2>
<p>在 InnoDB 存储引擎中，根据索引的存储形式，可以分为以下两种：</p>
<table>
<thead>
<tr>
<th style="text-align:center">分类</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">特点</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">聚集索引 (Clustered Index)</td>
<td style="text-align:center"><strong>将数据存储与索引放到了一块，索引结构的叶子节点保存了行数据</strong></td>
<td style="text-align:center"><strong>必须有，而且只有一个</strong></td>
</tr>
<tr>
<td style="text-align:center">二级索引 (Secondary Index)</td>
<td style="text-align:center">将数据与索引分开存储，索引结构的叶子节点关联的是对应的主键</td>
<td style="text-align:center">可以存在多个</td>
</tr>
</tbody>
</table>
<p>剧集索引选取规则：</p>
<ul>
<li>如果存在主键，那么主键索引就是聚集索引。</li>
<li>如果不存在主键，将使用第一个唯一 (UNIQUE) 索引作为聚集索引。</li>
<li>如果表没有主键，或没有合适的唯一索引，则 InnoDB 会自动生成一个 rowid 作为隐藏的聚集索引。</li>
</ul>
<p>回表查询：先通过二级索引进行查询，查询到对应的主键，然后再通过聚集索引查询到行数据。</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305061657943.png" alt="image-20230506165754773"></p>
<h2 id="索引语法"><a class="markdownIt-Anchor" href="#索引语法">#</a> 索引语法</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#创建索引：</span><br><span class="line">CREATE [UNIQUE|FULLTEXT] INDEX index_name ON table_name (index_col_name, ...);</span><br><span class="line">#查看索引：</span><br><span class="line">SHOW INDEX FROM table_name;</span><br><span class="line">#删除索引：</span><br><span class="line">DROP INDEX index_name ON table_name;</span><br></pre></td></tr></table></figure>
<p>创建索引时，通常使用如下命名方式：</p>
<p>idx_tableName_column</p>
<p>其中 idx 为 index 缩写，tableName 为表名，column 为索引字段。</p>
<h2 id="sql性能分析"><a class="markdownIt-Anchor" href="#sql性能分析">#</a> SQL 性能分析</h2>
<h3 id="sql执行频率"><a class="markdownIt-Anchor" href="#sql执行频率">#</a> SQL 执行频率</h3>
<p>MySQL 客户端连接成功后，通过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show [session|global] status</span><br></pre></td></tr></table></figure>
<p>命令可以提供服务器状态信息。通过如下指令，可以查看当前数据库的增、删、改、查的访问频次：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW GLOBAL STATUS LIKE &#x27;Com_______&#x27;;#共7个下划线</span><br></pre></td></tr></table></figure>
<p>通过该指令，可以知道该数据库使用哪些指令最频繁，可以对其进行优化。</p>
<h3 id="慢查询日志"><a class="markdownIt-Anchor" href="#慢查询日志">#</a> 慢查询日志</h3>
<p>慢查询日志记录了所有执行时间超过指定参数 (long_query_time, 单位：秒，默认 10 秒) 的所有 SQL 语句的日志</p>
<p>MySQL 的慢查询日志默认没有开启，需要在 MySQL 的配置文件 (/etc/my.cnf) 中配置如下信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#开启MySQL慢查询日志开关：</span><br><span class="line">slow_query_log=1</span><br><span class="line">#设置慢查询日志的时间为2秒，SQL语句执行时间超过2秒，就会被视为慢查询，记录到日志中</span><br><span class="line">long_query_time=2</span><br></pre></td></tr></table></figure>
<p>配置完成之后，通过指令重启 MySQL 服务器进行测试，查看慢日志文件中记录的信息，</p>
<p>路径：/var/lib/mysql/ 本机名 - slow.log</p>
<p>也可以通过指令开启：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#开启MySQL慢查询日志开关</span><br><span class="line">set global slow_query_log=ON;</span><br><span class="line">#设置慢查询日志的时间为2秒</span><br><span class="line">set long_query_time=2;</span><br></pre></td></tr></table></figure>
<p>在数据库中可以使用指令查看慢查询日志是否开启：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#x27;slow_query_log&#x27;;</span><br></pre></td></tr></table></figure>
<h3 id="profile详情"><a class="markdownIt-Anchor" href="#profile详情">#</a> profile 详情</h3>
<p>show profile 能够在做 SQL 优化时帮助了解时间消耗在哪里。</p>
<p>通过 have_profiling 参数，能够看到当前 M 有 SQL 是否支持 profile 操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#查看是否支持profile操作</span><br><span class="line">SELECT @@have_profiling;</span><br><span class="line">#查看是否开启</span><br><span class="line">SHOW VARIABLES LIKE &#x27;profiling&#x27;;</span><br><span class="line">#开启profile功能</span><br><span class="line">SET profiling=ON;</span><br><span class="line">#查看每一条SQL的耗时基本情况</span><br><span class="line">show profiles;</span><br><span class="line">#查看指定query_id的SQL语句各个阶段的耗时情况</span><br><span class="line">show profile for query query_id;</span><br><span class="line">#查看指定query_id的SQL语句CPU的使用情况</span><br><span class="line">show profile cpu for query query_id;</span><br></pre></td></tr></table></figure>
<h3 id="explain执行计划"><a class="markdownIt-Anchor" href="#explain执行计划">#</a> explain 执行计划</h3>
<p>EXPLAIN 或者 DESC 命令获取 MySQL 如何执行 SELECT 语句的信息，包括在 SELECT 语句执行过程中表如何连接和连接的顺序</p>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#直接在select语句之前加上关键字explain/desc</span><br><span class="line">EXPLAIN SELECT 字段列表 FROM 表名 WHERE 条件;</span><br></pre></td></tr></table></figure>
<p>查询结果：</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305061952536.png" alt="image-20230506195211376"></p>
<p>其中各个字段所表示的含义：</p>
<p>id：select 查询的序列号，表示查询中执行 select 子句或者是操作表的顺序 (id 相同，执行顺序从上到下；id 不同，值越大，越先执行)</p>
<p>select_type：表示 select 的类型，常见的取值有 SIMPLE (简单表，即不适用表连接或者子查询)、PRIMARY (主查询，即外层的查询)、UNION (UNION 中的第二个或者后面的查询语句)、SUBQUERY (SELECT/WHERE 之后包含了子查询) 等</p>
<p><strong>type：表示连接类型，性能由好到差的连接类型为：NULL、system、const、eq_ref、ref、range、index、all</strong></p>
<p><strong>possible_key：显示可能应用到这张表上的索引，一个或多个</strong></p>
<p><strong>key：实际使用的索引，如果为 NULL，则没有使用索引</strong></p>
<p><strong>Key_len：表示索引中使用的字节数，该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下，长度越短越好。</strong></p>
<p>rows：MySQL 认为必须要执行查询的行数，在 innoDB 引擎中，是一个估计值，可能并不总是准确的</p>
<p>filtered：表示返回结果的行数占需读取行数的百分比，filtered 的值越大越好</p>
<h2 id="索引使用"><a class="markdownIt-Anchor" href="#索引使用">#</a> 索引使用</h2>
<ul>
<li>最左前缀法则：</li>
</ul>
<p>如果索引了多列 (联合索引)，要遵守最左前缀法则。即<strong>查询从索引的最左列开始</strong>，并且不跳过索引中的列。</p>
<p>如果跳跃某一列，<strong>索引将部分失效 (后面的字段索引失效)</strong>。</p>
<ul>
<li>范围查询：</li>
</ul>
<p>联合索引中，出现范围查询 (&gt;, &lt;)，<strong>范围查询右侧的列索引失效</strong>。</p>
<p>如果业务允许，使用范围查询时尽量使用 (&gt;=, &lt;=)，这样不会使范围查询右侧的列索引失效。</p>
<ul>
<li>索引列运算：</li>
</ul>
<p>如果在索引列上进行运算操作，<strong>索引将失效</strong>。</p>
<ul>
<li>字符串类型：</li>
</ul>
<p>字符串类型字段使用时，不加引号，<strong>索引将失效</strong>。</p>
<ul>
<li>模糊查询：</li>
</ul>
<p>如果仅仅是尾部模糊匹配，索引不会失效。如果是头部模糊匹配，索引失效。</p>
<ul>
<li>or 连接的条件：</li>
</ul>
<p>用 or 分割开的条件，<strong>如果仅其中一个有索引，则索引会失效</strong>，必须在 or 连接的所有条件都有索引时，才会使用索引。</p>
<ul>
<li>数据分布影响：</li>
</ul>
<p>如果 MySQL 评估使用索引比全表更慢，则不使用索引。</p>
<ul>
<li><mark>SQL 提示：</mark></li>
</ul>
<p>SQL 提示是优化数据库的一个重要手段，简单来说，就是在 SQL 语句中加入一些人为的提示来达到优化操作的目的。</p>
<ol>
<li>use index (index_name)# 建议使用指定索引 (MySQL 会自己判断是否使用)</li>
<li>ignore index (index_name)# 忽略指定索引</li>
<li>force index (index_name)# 强制使用指定索引</li>
</ol>
<p>将其写在表名后面</p>
<ul>
<li><mark>覆盖索引：</mark></li>
</ul>
<p>尽量使用覆盖索引 (查询使用了索引，并且需要返回的列，在该索引中已经全部能够找到)，减少 select *</p>
<ul>
<li><mark>前缀索引：</mark></li>
</ul>
<p>当字段类型为字符串 (varchar、text 等) 时，有时候需要索引很长的字符串，这会让索引变得很大，查询时，浪费大量的磁盘 IO，影响查询效率。此时可以只将字符串的一部分前缀，建立索引，这样可以大大节约索引空间，从而提高索引效率。</p>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create index index_name on table_name(column(n));#n表示前缀长度</span><br></pre></td></tr></table></figure>
<p>前缀长度：</p>
<p>可以根据索引的选择性来决定，而选择性是指不重复的索引值 (基数) 和数据表的记录总数的比值，索引选择性越高则查询效率越高。</p>
<p>唯一索引的选择性是 1，这是最好的索引选择性，性能也是最好的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select count(distinct column) from table_name;#统计字段去重后的数量</span><br><span class="line">seselect count(distinct column)/count(*) from table_name;#计算索引选择性</span><br><span class="line"></span><br><span class="line">seselect count(distinct substring(column, 1, n))/count(*) from table_name;</span><br><span class="line">#将字段从第一个字符开始截取，截取n个字符，判断其索引选择性</span><br></pre></td></tr></table></figure>
<ul>
<li>单列索引与联合索引</li>
</ul>
<p>在业务场景中，如果存在多个查询条件，考虑针对于查询字段建立索引时，建议建立联合索引</p>
<h2 id="索引设计原则"><a class="markdownIt-Anchor" href="#索引设计原则">#</a> 索引设计原则</h2>
<ol>
<li>针对于数据量较大，且查询比较频繁的表建立索引。</li>
<li>针对于常作为查询条件 (where) 、排序 (orderby)、分组 (group by) 操作的字段建立索引。</li>
<li>尽量选择区分度高的列作为索引， 尽量建立唯一索引，区分度越高，使用索引的效率越高。</li>
<li>如果是字符串类型的字段，字段的长度较长，可以针对于字段的特点，建立前缀索引。</li>
<li>尽量使用联合索引， 减少单列索引，查询时，联合索引很多时候可以覆盖索引，节省存储空间，避免回表，提高查询效率。</li>
<li>要控制索引的数量，索引并不是多多益善，索引越多，维护索引结构的代价也就越大，会影响增删改的效率。</li>
<li>如果 索引列不能存储 NULL 值，请在创建表时使用 NOT NULL 约束它。当优化器知道每列是否包含 NULL 值时，它可以更好地确定哪个索引最有效地用于查询。</li>
</ol>
<h1 id="sql优化"><a class="markdownIt-Anchor" href="#sql优化">#</a> SQL 优化</h1>
<h2 id="insert优化"><a class="markdownIt-Anchor" href="#insert优化">#</a> insert 优化</h2>
<ul>
<li>推荐使用批量插入</li>
<li>手动提交事务，避免因 mysql 自动提交造成的多次提交</li>
<li>主键顺序插入</li>
</ul>
<h2 id="大批量插入数据load"><a class="markdownIt-Anchor" href="#大批量插入数据load">#</a> 大批量插入数据 (load)</h2>
<ul>
<li>如果一次性需要插入大批量数据，使用 insert 语句插入性能较低，此时可以使用 MySQL 数据库提供的 load 指令进行插入。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#客户端连接服务端时，加上参数 --local-infile</span><br><span class="line">mysql --local-infile -u root -p</span><br><span class="line">#这里的--local-infile表示需要加载本地文件</span><br><span class="line"></span><br><span class="line">#使用指令检查local_infile是否开启：</span><br><span class="line">select @@local_infile;</span><br><span class="line">#设置全局参数local_infile为1，开启从本地加载文件导入数据的开关</span><br><span class="line">set global local_infile=1;</span><br><span class="line"></span><br><span class="line">#执行load指令将准备好的数据，加载到表结构中：</span><br><span class="line">load data local infile &#x27;/file_name&#x27; into table table_name fields terminated by &#x27;,&#x27; lines terminated by &#x27;\n&#x27;;</span><br><span class="line">#其中&#x27;file_name&#x27;处填写文件路径</span><br><span class="line">#第一个&#x27;,&#x27;为字段限制</span><br><span class="line">#第二个&#x27;\n&#x27;为行限制</span><br></pre></td></tr></table></figure>
<h2 id="主键优化"><a class="markdownIt-Anchor" href="#主键优化">#</a> 主键优化</h2>
<ul>
<li>数据组织方式</li>
</ul>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305081510662.png" alt="image-20230508151018455"></p>
<ul>
<li>页分裂</li>
</ul>
<p>页可以为空，也可以填充一半，也可以填充 100%。</p>
<p>每个页包含了 2-N 行数据 (如果一行数据过大，会行溢出)，根据主键排列。</p>
<p><strong>主键顺序插入示意图：</strong></p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305081513612.png" alt="image-20230508151340508"></p>
<p><strong>主键乱序插入导致页分裂示意图：</strong></p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305081514227.png" alt="image-20230508151458116"></p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305081514238.png" alt="image-20230508151416118"></p>
<ul>
<li>页合并</li>
</ul>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305081517141.png" alt="image-20230508151700027"></p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305081517874.png" alt="image-20230508151756743"></p>
<ul>
<li>主键设计原则：</li>
</ul>
<p>满足业务需求的情况下，尽量降低主键的长度。</p>
<p>插入数据时，尽量选择顺序插入，选择使用 AUTO_INCREMENT 自增主键。</p>
<p>尽量不要使用 UUID 作为主键或者其他自然主键，如身份证号 (因为它们不具备顺序性、且长度较长)。</p>
<p>业务操作时，避免对主键的修改。</p>
<h2 id="order-by优化"><a class="markdownIt-Anchor" href="#order-by优化">#</a> order by 优化</h2>
<ol>
<li>Using filesort：通过表的索引或全表扫描，读取满足条件的数据行，然后在排序缓冲区 sort buffer 中完成排序操作，所有不是通过索引直接返回排序结果的排序都叫 FileSort 排序。</li>
<li>Using index：通过有序索引顺序扫描直接返回有序数据，这种情况即为 using index，不需要额外排序，操作效率高。</li>
</ol>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305081600442.png" alt="image-20230508160059268"></p>
<ul>
<li>根据排序字段建立合适的索引，多字段排序时，也遵循最左前缀法则</li>
<li>尽量使用覆盖索引</li>
<li>多字段排序，一个升序一个降序，此时需要注意联合索引在创建时的规则 (ASC/DESC)</li>
<li>如果不可避免的出现 filesort，大量数据排序时，可以适当增大排序缓冲区大小 sort_buffer_size (默认 256k)</li>
</ul>
<h2 id="group-by优化"><a class="markdownIt-Anchor" href="#group-by优化">#</a> group by 优化</h2>
<p>与 order by 类似</p>
<h2 id="limit优化"><a class="markdownIt-Anchor" href="#limit优化">#</a> limit 优化</h2>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305081623188.png" alt="image-20230508162020948"></p>
<h2 id="count优化"><a class="markdownIt-Anchor" href="#count优化">#</a> count 优化</h2>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305081629652.png" alt="image-20230508162925536"></p>
<p>count 的几种用法</p>
<ul>
<li>
<p>count () 是一个聚合函数，对于返回的结果集，一行行的判断，如果 count 函数的参数不是 null，累计值就加 1，否则不加，最后返回累计值。</p>
</li>
<li>
<p>用法：count (*)、count (主键)、count (字段)、count (1)</p>
</li>
<li>
<p>按效率排序：count (字段)&lt;count (主键)&lt;count (1) 约等于 count (*)</p>
</li>
</ul>
<h2 id="update优化"><a class="markdownIt-Anchor" href="#update优化">#</a> update 优化</h2>
<p>InnoDB 拥有行锁，通过事务对表进行更新时，可以仅锁定行。</p>
<p>但只有通过索引的修改才会使用行锁，<strong>如果未建立相应索引，则会导致表锁</strong>，从而降低并发性能。</p>
<p><strong>因此尽量使用有索引的字段进行 update</strong>。</p>
<h1 id="视图"><a class="markdownIt-Anchor" href="#视图">#</a> 视图</h1>
<h2 id="基础"><a class="markdownIt-Anchor" href="#基础">#</a> 基础</h2>
<p>介绍：视图 (View) 是一种虚拟存在的表。视图中的数据并不在数据库中实际存在，行和列数据来自定义视图的查询中使用的表，并且是在使用视图时动态生成的。</p>
<p>通俗的讲，视图只保存了查询的 SQL 逻辑，不保存查询结果。所以我们在创建视图的时候，主要的工作就落在创建这条 SQL 查询语句上。</p>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#创建</span><br><span class="line">CREATE [OR REPLACE] VIEW 视图名[(列名列表)] \</span><br><span class="line">AS SELECT语句 [WITH [CASCADED | LOCAL] CHECK OPTION];</span><br><span class="line"></span><br><span class="line">#查询</span><br><span class="line">SHOW CREATE VIEW view_name;#查看创建视图语句</span><br><span class="line">SELECT * FROM view_name ...;#查看视图数据</span><br><span class="line"></span><br><span class="line">#修改</span><br><span class="line">#方式一：</span><br><span class="line">CREATE [OR REPLACE] VIEW view_name[(列名列表)] \</span><br><span class="line">AS SELECT语句 [WITH [CASCADED | LOCAL] CHECK OPTION];</span><br><span class="line">#方式二：</span><br><span class="line">ALTER VIEW view_name[(列名列表)] AS SELECT语句 [WITH [CASCADED | LOCAL] CHECK OPTION];</span><br><span class="line"></span><br><span class="line">#删除</span><br><span class="line">DROP VIEW [IF EXISTS] view_name [,view_name2 ...];</span><br></pre></td></tr></table></figure>
<h2 id="视图检查选项"><a class="markdownIt-Anchor" href="#视图检查选项">#</a> 视图检查选项</h2>
<p>当使用 WITH CHECK OPTION 子句创建视图时，MySQL 会通过视图检查正在更改的每个行，例如插入，更新，删除，以使其符合视图的定义。</p>
<p>MySQL 允许基于另一个视图创建视图，它还会检查依赖视图中的规则以保持一致性。</p>
<p>为了确定检查的范围，MySQL 提供了两个选项：CASCADED 和 LOCAL，默认值为 CASCADED。</p>
<p>CASCADED 会向上添加 CASCADED 进行检查。</p>
<p>LOCAL 仅会在该视图进行检查，并不会向上添加。</p>
<h2 id="更新及作用"><a class="markdownIt-Anchor" href="#更新及作用">#</a> 更新及作用</h2>
<p><strong>视图的更新：</strong></p>
<p>要使视图可更新，视图中的行与基础表中的行之间必须存在一对一的关系。</p>
<p>如果视图包含以下任何一项，即该视图不可更新：</p>
<ol>
<li>聚合函数或窗口函数 (SUM ()、MIN ()、MAX ()、COUNT () 等)</li>
<li>DISTINCT</li>
<li>GROUP BY</li>
<li>HAVING</li>
<li>UNION 或者 UNION ALL</li>
<li>其他导致视图行与基础表行不能一对一的操作</li>
</ol>
<p><strong>作用：</strong></p>
<ul>
<li>简单：视图不仅可以简化用户对数据的理解，也可以简化他们的操作。那些被经常使用的查询可以被定义为视图，从而使得用户不必为以后的操作每次指定全部的条件。</li>
<li>安全：数据库可以授权，但不能授权到数据库特定行和特定的列上。通过视图用户只能查询和修改他们所能见到的数据。</li>
<li>数据独立：视图可以帮助用户屏蔽真实表结构变化带来的影响。</li>
</ul>
<h1 id="存储过程类似于函数"><a class="markdownIt-Anchor" href="#存储过程类似于函数">#</a> <mark>存储过程 (类似于函数)</mark></h1>
<ul>
<li>介绍</li>
</ul>
<p>存储过程是事先经过编译并存储再数据库中的一段 SQL 语句的集合，调用存储过程可以简化应用开发人员的很多工作，减少数据在数据库和应用服务器之间的传输，对于提高数据处理的效率是有好处的。</p>
<p>存储过程思想上很简单，就是数据库 SQL 语言层面的代码封装与重用。</p>
<ul>
<li>特点</li>
</ul>
<p>封装、复用</p>
<p>可以接收参数，也可以返回数据</p>
<p>减少网络交互，效率提升</p>
<h2 id="语法-2"><a class="markdownIt-Anchor" href="#语法-2">#</a> 语法</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#创建</span><br><span class="line">CREATE PROCEDURE 存储过程名称([参数列表])</span><br><span class="line">BEGIN</span><br><span class="line">	--SQL语句</span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">#调用</span><br><span class="line">CALL 名称([参数]);</span><br><span class="line"></span><br><span class="line">#查看</span><br><span class="line">#查询指定数据库的存储过程及状态信息</span><br><span class="line">SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_SCHEMA = &#x27;database_name&#x27;;</span><br><span class="line">#查询某个存储过程的定义</span><br><span class="line">SHOW CREATE PROCEDURE 存储过程名称;</span><br><span class="line"></span><br><span class="line">#删除</span><br><span class="line">DROP PROCEDURE [IF EXISTS] 存储过程名称;</span><br></pre></td></tr></table></figure>
<p>在命令行中创建存储过程时，因为识别分号即语句结束，而 SQL 语句中也包含分号。</p>
<p>因此可能会导致代码产生错误，即不能读取到 END; 部分便结束了。</p>
<p>需要重新指定语句结束的符号，使用 delimiter 重新定义结束符号。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$	#重新指定结束符为$$</span><br><span class="line">create procedure p_name()</span><br><span class="line">begin</span><br><span class="line">	select * from example_table;</span><br><span class="line">end$$	#$$标志着语句结束</span><br><span class="line">#注意，重新指定结束符后，不仅仅对存储过程创建有效，例如：</span><br><span class="line">call p_name()$$</span><br></pre></td></tr></table></figure>
<h2 id="变量"><a class="markdownIt-Anchor" href="#变量">#</a> 变量</h2>
<ul>
<li><strong>系统变量：</strong></li>
</ul>
<p>系统变量是 MySQL 服务器提供，不是用户定义的，属于服务器层面。</p>
<p>分为全局变量 (GLOBAL)、会话变量 (SESSION)。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#查看系统变量</span><br><span class="line">#默认为SESSION</span><br><span class="line">SHOW [SESSION | GLOBAL] VARIABLES;#显示所有系统变量</span><br><span class="line">SHOW [SESSION | GLOBAL] VARIABLES LIKE &#x27;...&#x27;;#通过like模糊匹配查找变量</span><br><span class="line">SELECT @@[SESSION | GLOBAL] 系统变量名;#查看指定变量的值</span><br><span class="line"></span><br><span class="line">#设置系统变量</span><br><span class="line">SET [SESSION | GLOBAL] 系统变量名=值;</span><br><span class="line">SET @@[SESSION | GLOBAL]系统变量名=值；</span><br></pre></td></tr></table></figure>
<p>注意：mysql 服务重新启动之后，所设置的全局参数会失效，如果不想失效，需要在 /etc/my.cnf 中配置。</p>
<ul>
<li><strong>用户自定义变量：</strong></li>
</ul>
<p>用户自定义变量是用户根据需要自己定义的变量，用户变量不用提前声明。</p>
<p>在使用的时候可以直接用 &quot;@变量名&quot; 使用就可以。<strong>其作用域为当前会话。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#赋值</span><br><span class="line">SET @var_name = expr [, @var_name2 = expr]...;</span><br><span class="line">SET @var_name := expr [, @var_name2 := expr]...;</span><br><span class="line">SELECT @var_name := expr [, @var_name2 := expr]...;</span><br><span class="line">SELECT 字段名 INTO @var_name FROM 表名;</span><br><span class="line"></span><br><span class="line">#使用</span><br><span class="line">SELECT @var_name;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>局部变量：</strong></li>
</ul>
<p>局部变量是根据需要定义的在局部生效的变量，访问之前，需要 DECLARE 声明。可用作存储过程中的局部变量和输入参数，局部变量的范围是在其内声明的 BEGIN…END 块。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#声明</span><br><span class="line">DECLARE 变量名 变量类型[DEFAULT ...];</span><br><span class="line"></span><br><span class="line">#赋值</span><br><span class="line">SET 变量名=值;</span><br><span class="line">SET 变量名:=值;</span><br><span class="line">SELECT 字段名 INTO 变量名 FROM 表名 ...;</span><br></pre></td></tr></table></figure>
<h2 id="if语句"><a class="markdownIt-Anchor" href="#if语句">#</a> if 语句</h2>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">IF 条件1 THEN</span><br><span class="line">	...</span><br><span class="line">ELSEIF 条件2 THEN</span><br><span class="line">	...</span><br><span class="line">ELSE</span><br><span class="line">	...</span><br><span class="line">END IF;</span><br><span class="line">#if语句，编程基础，没啥好说的</span><br></pre></td></tr></table></figure>
<h2 id="参数"><a class="markdownIt-Anchor" href="#参数">#</a> 参数</h2>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IN</td>
<td style="text-align:center">该类参数作为输入，也就是需要调用时传入值 (默认为该类型)</td>
</tr>
<tr>
<td style="text-align:center">OUT</td>
<td style="text-align:center">该类型作为输出，也就是该参数可以作为返回值</td>
</tr>
<tr>
<td style="text-align:center">INOUT</td>
<td style="text-align:center">既可以作为输入参数，也可以作为输出参数</td>
</tr>
</tbody>
</table>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create procedure p_name(in score int, out result varchar(10))</span><br><span class="line">begin</span><br><span class="line">	if score &gt;= 85 then</span><br><span class="line">		set result := &#x27;You_Xiu&#x27;;</span><br><span class="line">	elseif score &gt;= 60 then</span><br><span class="line">		set result := &#x27;Ji_Ge&#x27;;</span><br><span class="line">	else</span><br><span class="line">		set result := &#x27;Bu_Ji_Ge&#x27;;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>
<h2 id="case语句"><a class="markdownIt-Anchor" href="#case语句">#</a> case 语句</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#方式一：</span><br><span class="line">CASE case_value</span><br><span class="line">	WHEN when_value1 THEN statement_list1</span><br><span class="line">	[WHEN when_value2 THEN statement_list2]...</span><br><span class="line">	[ELSE statement_list]</span><br><span class="line">END CASE;</span><br><span class="line"></span><br><span class="line">#方式二：</span><br><span class="line">CASE</span><br><span class="line">	WHEN search_condition1 THEN statement_list1</span><br><span class="line">	[WHEN search_condition2 THEN statement_list2]...</span><br><span class="line">	[ELSE statement_list]</span><br><span class="line">END CASE;</span><br><span class="line">#switch语句，编程基础，没啥好说的</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">create procedure p_name(in month int, out result varchar(20))</span><br><span class="line">begin</span><br><span class="line">	case</span><br><span class="line">		when month &gt;= 1 and month &lt;= 3 then</span><br><span class="line">			set result := &#x27;First_Quarter&#x27;;</span><br><span class="line">		when month &gt;= 4 and month &lt;= 6 then</span><br><span class="line">			set result := &#x27;Second_Quarter&#x27;;</span><br><span class="line">		when month &gt;= 7 and month &lt;= 9 then</span><br><span class="line">			set result := &#x27;Third_Quarter&#x27;;</span><br><span class="line">		when month &gt;= 10 and month &lt;= 12 then</span><br><span class="line">			set result := &#x27;Fourth_Quarter&#x27;;</span><br><span class="line">		else</span><br><span class="line">			set result := &#x27;illegal_Parameter&#x27;;</span><br><span class="line">	end case;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>
<h2 id="循环whilerepeatloop"><a class="markdownIt-Anchor" href="#循环whilerepeatloop">#</a> 循环 (while/repeat/loop)</h2>
<p><strong>while：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">WHILE condition DO</span><br><span class="line">	SQL...</span><br><span class="line">END WHILE;</span><br><span class="line">#while语句，示例：</span><br><span class="line">#统计0-n的和：</span><br><span class="line">create procedure p_example(in n int, out result int)</span><br><span class="line">begin</span><br><span class="line">	set result := 0;</span><br><span class="line">	while n &gt;= 0 do</span><br><span class="line">		set result := result + n;</span><br><span class="line">		set n := n - 1;</span><br><span class="line">	end while;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>
<p><strong>repeat：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">REPEAT</span><br><span class="line">	SQL...</span><br><span class="line">	UNTIL 条件</span><br><span class="line">END REPEAT;</span><br><span class="line">#首先执行一次(类似do..while)，当满足条件时退出循环，这点不同于do...while</span><br><span class="line">#示例，统计0-n的值：</span><br><span class="line">create procedure p_example(in n int)</span><br><span class="line">begin</span><br><span class="line">	declare result int default 0;</span><br><span class="line">	</span><br><span class="line">	repeat</span><br><span class="line">		set result := result + n;</span><br><span class="line">		set n := n - 1;</span><br><span class="line">	until n &lt;= 0#注意该条件后无分号！</span><br><span class="line">	end repeat;</span><br><span class="line">	</span><br><span class="line">	select result;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>
<p><strong>loop：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#loop是一个仅由LEAVE(break)和ITERATE(continue)关键字控制的死循环</span><br><span class="line">[begin_label:] LOOP</span><br><span class="line">	SQL...</span><br><span class="line">END LOOP [end_label];</span><br><span class="line">LEAVE label; #退出指定标记的循环体</span><br><span class="line">ITERATE label; #直接进入下一次循环</span><br><span class="line"></span><br><span class="line">#示例，统计0到n的和：</span><br><span class="line">create procedure p_example(in n int, out result int)</span><br><span class="line">begin</span><br><span class="line">	set result := 0;</span><br><span class="line">	sum:loop</span><br><span class="line">		if n &lt;= 0 then</span><br><span class="line">			leave sum;</span><br><span class="line">		end if;</span><br><span class="line">		</span><br><span class="line">		set result := result + n;</span><br><span class="line">		set n := n - 1;</span><br><span class="line">	end loop sum;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>
<h2 id="游标"><a class="markdownIt-Anchor" href="#游标">#</a> 游标</h2>
<p>游标 (CURSOR) 是用来存储查询结果集的数据类型，在存储过程和函数中可以使用游标对结果集进行循环和处理。游标的使用包括游标的声明、OPEN、FETCH 和 CLOSE，其语法分别如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#声明游标</span><br><span class="line">DECLARE CURSOR_NAME CURSOR FOR 查询语句;</span><br><span class="line"></span><br><span class="line">#打开游标</span><br><span class="line">OPEN CURSOR_NAME;</span><br><span class="line"></span><br><span class="line">#获取游标记录</span><br><span class="line">FETCH CURSOR_NAME INTO 变量 [, 变量];</span><br><span class="line"></span><br><span class="line">#关闭游标</span><br><span class="line">CLOSE CURSOR_NAME;</span><br></pre></td></tr></table></figure>
<p>使用案例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#根据传入的参数uage，查询用户表tb_user中，所有年龄小于uage的用户姓名和专业</span><br><span class="line">#并将查询到的数据插入到一张新表(id,name,profession)中</span><br><span class="line">create procedure p_test(in uage int)</span><br><span class="line">begin</span><br><span class="line">	declare uname varchar(100);</span><br><span class="line">	declare upro varchar(100);</span><br><span class="line">	declare u_cursor cursor for select name, profession from tb_user where age &lt;= uage;#注意：游标的声明需要在普通变量之后</span><br><span class="line">	declare exit handler for SQLSTATE &#x27;02000&#x27; close u_cursor;</span><br><span class="line">	#这条语句看下面条件处理程序的解释</span><br><span class="line">	</span><br><span class="line">	create table if not exists tb_user_pro(</span><br><span class="line">    	id int primary key auto_increment,</span><br><span class="line">        name varchar(100),</span><br><span class="line">        profession varchar(100)</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    open u_cursor;</span><br><span class="line">    while true do</span><br><span class="line">    	fetch u_cursor into uname,upro;</span><br><span class="line">    	insert into tb_user_pro values (null, uname, upro);</span><br><span class="line">    end while;</span><br><span class="line">    close u_cursor;</span><br><span class="line">    </span><br><span class="line">end;</span><br></pre></td></tr></table></figure>
<h2 id="条件处理程序"><a class="markdownIt-Anchor" href="#条件处理程序">#</a> 条件处理程序</h2>
<p>条件处理程序 (Handler) 可以用来定义在流程控制结构执行过程中遇到问题时相应的处理步骤，语法为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DECLARE handler_action HANDLER FOR condition_value [, condition_value]... statement;</span><br><span class="line"></span><br><span class="line">handler_action</span><br><span class="line">	continue:#继续执行当前程序</span><br><span class="line">	exit:#终止执行当前程序</span><br><span class="line">condition_value</span><br><span class="line">	SQLSTATE sqlstate_value:#状态码，如02000</span><br><span class="line">	SQLWARNING:#所有以01开头的SQLSTATE代码的简写</span><br><span class="line">	NOT FOUND:#所有以02开头的SQLSTATE代码的简写</span><br><span class="line">	SQLEXCEPTION:#所有没有被SQLWARNING或者NOT FOUND捕获的SQLSTATE代码的简写</span><br></pre></td></tr></table></figure>
<p>示例：当游标为空时，退出循环</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">declare exit handler for SQLSTATE &#x27;02000&#x27; close u_cursor;</span><br><span class="line">#声明一个条件处理程序，当满足状态码为02000时触发退出操作，并关闭游标</span><br><span class="line">#02000处也可以写为NOT FOUND，对于状态码的细节，可以查询mysql官方文档</span><br></pre></td></tr></table></figure>
<h2 id="存储函数"><a class="markdownIt-Anchor" href="#存储函数">#</a> 存储函数</h2>
<p>存储函数是有返回值的存储过程，存储函数的参数只能是 IN 类型。语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION 存储函数名称([参数列表])</span><br><span class="line">RETURNS type [characteristic...]</span><br><span class="line">BEGIN</span><br><span class="line">	--SQL</span><br><span class="line">	RETURN ...;</span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">#characteristic说明：</span><br><span class="line">#DETERMINISTIC：相同的输入参数总是产生相同的结果</span><br><span class="line">#NO SQL：不包含SQL语句</span><br><span class="line">#READS SQL DATA：包含读取数据的语句，但不包含写入数据的语句</span><br></pre></td></tr></table></figure>
<p>使用示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#累加1-n</span><br><span class="line">create function fun_example(n int)</span><br><span class="line">returns int deterministic</span><br><span class="line">begin</span><br><span class="line">    declare result int default 0;</span><br><span class="line"></span><br><span class="line">    while n &gt; 0 do</span><br><span class="line">        set result := result + n;</span><br><span class="line">        set n := n - 1;</span><br><span class="line">    end while;</span><br><span class="line"></span><br><span class="line">    return result;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>
<h1 id="触发器"><a class="markdownIt-Anchor" href="#触发器">#</a> <mark>触发器</mark></h1>
<p>触发器是与表有关的数据库对象，指在 insert/update/delete 之前或之后，触发并执行触发器中定义的 SQL 语句集合。触发器的这种特性可以协助应用在数据库端确保数据的完整性，日志记录，数据校验等操作。</p>
<p>使用别名 OLD 和 NEW 来引用触发器中发生变化的记录内容，这与其他的数据库是相似的。</p>
<p>现在触发器还只支持行级触发，不支持语句级触发。</p>
<table>
<thead>
<tr>
<th style="text-align:center">触发器类型</th>
<th style="text-align:center">NEW 和 OLD</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">INSERT 型触发器</td>
<td style="text-align:center">NEW 表示将要或者已经新增的数据</td>
</tr>
<tr>
<td style="text-align:center">UPDATE 型触发器</td>
<td style="text-align:center">OLD 表示修改之前的数据，NEW 表示将要或已经修改后的数据</td>
</tr>
<tr>
<td style="text-align:center">DELETE 型触发器</td>
<td style="text-align:center">OLD 表示将要或者已经删除的数据</td>
</tr>
</tbody>
</table>
<p><strong>语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#创建</span><br><span class="line">CREATE TRIGGER trigger_name</span><br><span class="line">BEFORE/AFTER INSERT/UPDATE/DELETE</span><br><span class="line">ON tbl_name FOR EACH ROW #行级触发器</span><br><span class="line">BEGIN</span><br><span class="line">	trigger_stmt;</span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">#查看</span><br><span class="line">SHOW TRIGGERS;</span><br><span class="line"></span><br><span class="line">#删除</span><br><span class="line">DROP TRIGGER [schema_name.] trigger_name;</span><br><span class="line">#如果没有指定schema_name，则默认为当前数据库</span><br></pre></td></tr></table></figure>
<p>使用示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#查看触发器</span><br><span class="line">show triggers ;</span><br><span class="line">#插入数据</span><br><span class="line">create trigger tb_user_insert_trigger#创建插入触发器</span><br><span class="line">    after insert on tb_user for each row#触发器级别为行级</span><br><span class="line">begin</span><br><span class="line">	#向user_log表插入数据</span><br><span class="line">    insert into user_log(id, operation, operate_time, operate_id, operate_params) values</span><br><span class="line">    (null, &#x27;insert&#x27;, now(), new.id, concat(&#x27;insert data:id=&#x27;,new.id,&#x27;,name=&#x27;,new.name,&#x27;,phone&#x27;,new.phone,&#x27;,email=&#x27;,new.email,&#x27;,profession=&#x27;,new.profession));</span><br><span class="line">    #使用concat拼接字符串作为operate_params插入</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">#以下内容与插入触发器类似</span><br><span class="line">#修改数据</span><br><span class="line">create trigger tb_user_update_trigger</span><br><span class="line">    after update on tb_user for each row</span><br><span class="line">begin</span><br><span class="line">    insert into user_log(id, operation, operate_time, operate_id, operate_params)</span><br><span class="line">    values (null, &#x27;update&#x27;, now(), new.id,</span><br><span class="line">            concat(&#x27;before update data:id=&#x27;,old.id,&#x27;,name=&#x27;,old.name,&#x27;,phone&#x27;,old.phone,&#x27;,email=&#x27;,old.email,&#x27;,profession=&#x27;,old.profession,</span><br><span class="line">                   &#x27;after update data:id=&#x27;,new.id,&#x27;,name=&#x27;,new.name,&#x27;,phone&#x27;,new.phone,&#x27;,email=&#x27;,new.email,&#x27;,profession=&#x27;,new.profession));</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">#删除数据</span><br><span class="line">create trigger tb_user_delete_trigger</span><br><span class="line">    after delete on tb_user for each row</span><br><span class="line">begin</span><br><span class="line">    insert into user_log(id, operation, operate_time, operate_id, operate_params)</span><br><span class="line">    values (null, &#x27;delete&#x27;, now(), old.id,</span><br><span class="line">            concat(&#x27;delete data:id=&#x27;,old.id,&#x27;,name=&#x27;,old.name,&#x27;,phone&#x27;,old.phone,&#x27;,email=&#x27;,old.email,&#x27;,profession=&#x27;,old.profession));</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>
<h1 id="锁"><a class="markdownIt-Anchor" href="#锁">#</a> 锁</h1>
<ul>
<li>介绍</li>
</ul>
<p>锁是计算机协调多个进程或线程并发访问某一资源的机制。</p>
<p>在数据库中，除传统的计算资源 (CPU、RAM、I/O) 的争用以外，数据也是一种供许多用户共享的资源。</p>
<p>如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是影响数据库并发访问性能的一个重要因素。</p>
<p>从这个角度来说，锁对数据库而言显得尤其重要，也更加复杂。</p>
<ul>
<li>分类</li>
</ul>
<p>MySQL 中的锁，按照锁的粒度划分，可以分为以下三类：</p>
<ol>
<li>全局锁：锁定数据库中的所有表</li>
<li>表级锁：每次操作锁住整张表</li>
<li>行级锁：每次操作锁住对应的行数据</li>
</ol>
<h2 id="全局锁"><a class="markdownIt-Anchor" href="#全局锁">#</a> 全局锁</h2>
<p>全局锁就是对整个数据库实例加锁，加锁后整个实例就处于只读状态，后续的 DML 的写语句，DDL 语句，已经更新操作的事务提交语句都将被阻塞。</p>
<p>其典型的使用场景是做全库的逻辑备份，对所有的表进行锁定，从而获取一致性视图，保证数据的完整性。</p>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#添加全局锁</span><br><span class="line">flush tables with read lock;</span><br><span class="line"></span><br><span class="line">#数据备份指令</span><br><span class="line">mysqldump -uroot -p密码 数据库&gt;存储文件.sql</span><br><span class="line"></span><br><span class="line">#解除全局锁</span><br><span class="line">unlock tables;</span><br></pre></td></tr></table></figure>
<p>特点：</p>
<p>数据库中加全局锁，是一个比较重要的操作，存在以下问题：</p>
<ol>
<li>如果在主库上备份，那么备份期间都不能执行更新，业务基本上就要停摆</li>
<li>如果在从库上备份，那么备份期间从库就不能执行主库同步过来的二进制日志 (binlog)，会导致主从延迟</li>
</ol>
<p>在 InnoDB 引擎中，我们可以在备份时加上参数–single-transaction 参数来完成不加锁的一致性数据备份。</p>
<h2 id="表级锁"><a class="markdownIt-Anchor" href="#表级锁">#</a> 表级锁</h2>
<p>表级锁，每次操作锁住整张表。锁定粒度大，发生锁冲突的概率最高，并发度最低。</p>
<p>应用在 MyISAM、InnoDB、BDB 等存储引擎中。</p>
<p>对于表级锁，主要分为以下三类：</p>
<ol>
<li>表锁</li>
<li>元数据锁 (meta data lock  MDL)</li>
<li>意向锁</li>
</ol>
<p><strong>对于表锁，分为以下两类：</strong></p>
<ol>
<li>表共享读锁 (read lock)，读锁只阻塞其他客户端的写入操作，不阻塞读取操作</li>
<li>表独占写锁 (write lock)，阻塞其他客户端的读写操作</li>
</ol>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#加锁</span><br><span class="line">lock tables 表名 ... read/write;</span><br><span class="line"></span><br><span class="line">#释放锁</span><br><span class="line">unlock tables; #或者客户端断开连接</span><br></pre></td></tr></table></figure>
<p><strong>元数据锁 (meta data lock)：</strong></p>
<p>MDL 加锁过程是系统自动控制，无需显式使用，在访问一张表的时候会自动添加。</p>
<p>MDL 锁主要作用是维护表元数据的数据一致性，在表上有活动事务的时候，不可以对元数据进行写入操作。</p>
<p>为了避免 DML 与 DDL 冲突，保证读写的正确性。</p>
<p>在 MySQL5.5 中引入了 MDL，当对一张表进行增删改查的时候，添加 MDL 读锁 (共享)。</p>
<p>当对表结构进行变更操作时，添加 MDL 写锁 (排他)</p>
<table>
<thead>
<tr>
<th style="text-align:center">对应 SQL</th>
<th style="text-align:center">锁类型</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">lock tables xxx read/write</td>
<td style="text-align:center">SHARED_READ_ONLY / SHARED_NO_READ_WRITE</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">select、select … lock in share mode</td>
<td style="text-align:center">SHARED_READ</td>
<td style="text-align:center">与 SHARED_READ、SHARED_WRITE 兼容，与 EXCLUSIVE 互斥</td>
</tr>
<tr>
<td style="text-align:center">insert、update、delete、select … for update</td>
<td style="text-align:center">SHARED_WRITE</td>
<td style="text-align:center">与 SHARED_READ、SHARED_WRITE 兼容，与 EXCLUSIVE 互斥</td>
</tr>
<tr>
<td style="text-align:center">alter table …</td>
<td style="text-align:center">EXCLUSIVE</td>
<td style="text-align:center">与其他 MDL 都互斥</td>
</tr>
</tbody>
</table>
<p><strong>意向锁：</strong></p>
<p>为了避免 DML 在执行时，加的行锁与表锁冲突，在 InnoDB 中引入了意向锁，使得表锁不用检查每行数据是否加锁，使用意向锁来减少表锁的检查。</p>
<ol>
<li>意向共享锁 (IS)：由语句 select … lock in share mode 添加，与表锁共享锁 (read) 兼容，与表锁排它锁 (write) 互斥。</li>
<li>意向排他锁 (IX)：由 insert、update、delete、select … for update 添加，与表锁共享、排它锁都互斥。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#通过以下语句，查看意向锁及行锁的加锁情况：</span><br><span class="line">select obeject_schema,object_name,index_name,lock_type,lock_mode,lock_data </span><br><span class="line">from performance_schema.data_locks;</span><br></pre></td></tr></table></figure>
<h2 id="行级锁"><a class="markdownIt-Anchor" href="#行级锁">#</a> 行级锁</h2>
<p>行级锁，每次操作锁住对应的行数据。锁定粒度最小，发生冲突的概率最低，并发度最高。应用在 InnoDB 存储引擎中。</p>
<p>InnoDB 的数据是基于索引组织的，行锁是通过对索引上的索引项加锁来实现的，而不是对记录加锁。</p>
<p><strong>对于行级锁，主要分为以下三类：</strong></p>
<ol>
<li>行锁 (Recored Lock)：锁定单个行记录的锁，防止其他事务对此行进行 update 和 delete。在 RC、RR 隔离级别下都支持。</li>
<li>间隙锁 (Gap Lock)：锁定索引记录间隙 (不包含该记录)，确保索引记录间隙不变，防止其他事务在这个间隙进行 insert，产生幻读。在 RR 隔离级别下都支持。</li>
<li>临键锁 (Next-Key Lock)：行锁和间隙锁的组合，同时锁住数据和间隙。在 RR 隔离级别下支持。</li>
</ol>
<p><strong>行锁</strong></p>
<p>InnoDB 实现了以下两种类型的行锁：</p>
<ol>
<li>共享锁 (S)：允许一个事务去读一行，阻止其他事务获得相同数据集的排它锁</li>
<li>排它锁 (X)：允许获取排它锁的事务更新数据，阻止其他事务获得相同数据集的共享锁和排它锁</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center">SQL</th>
<th style="text-align:center">行锁类型</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">INSERT</td>
<td style="text-align:center">排它锁</td>
<td style="text-align:center">自动加锁</td>
</tr>
<tr>
<td style="text-align:center">UPDATE</td>
<td style="text-align:center">排它锁</td>
<td style="text-align:center">自动加锁</td>
</tr>
<tr>
<td style="text-align:center">DELETE</td>
<td style="text-align:center">排它锁</td>
<td style="text-align:center">自动加锁</td>
</tr>
<tr>
<td style="text-align:center">SELECT (正常)</td>
<td style="text-align:center">不加锁</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">SELECT … LOCK IN SHARE MODE</td>
<td style="text-align:center">共享锁</td>
<td style="text-align:center">需要手动在 SELECT 之后加 LOCK IN SHARE MODE</td>
</tr>
<tr>
<td style="text-align:center">SELECT … FOR UPDATE</td>
<td style="text-align:center">排它锁</td>
<td style="text-align:center">需要手动在 SELECT 之后加 FOR UPDATE</td>
</tr>
</tbody>
</table>
<p>默认情况下，InnoDB 在 REPEATABLE READ 事务隔离级别运行，InnoDB 使用临键锁进行搜索和索引扫描，以防止幻读。</p>
<ol>
<li>针对唯一索引进行检索时，对已存在的记录进行等值匹配时，将会自动优化为行锁</li>
<li>InnoDB 的行锁是针对于索引加的锁，不通过索引条件检索数据，那么 InnoDB 将对表中的所有记录加锁，此时就会升级为表锁</li>
</ol>
<p><strong>间隙锁 / 临键锁</strong></p>
<p>默认情况下，InnoDB 在 REPEATABLE READ 事务隔离级别运行，InnoDB 使用临键锁进行搜索和索引扫描，以防止幻读。</p>
<ol>
<li>索引上的等值查询 (唯一索引)，给不存在的记录加锁时，优化为间隙锁</li>
<li>索引上的等值查询 (普通索引)，向右遍历时最后一个值不满足查询需求时，临键锁退化为间隙锁</li>
<li>索引上的范围查询 (唯一索引)–会访问到不满足条件的第一个值为止</li>
</ol>
<p>注意：间隙锁唯一目的是防止其他事务插入间隙。间隙锁可以共存，一个事务采用的间隙锁不会阻止另一个事务在同一间隙上采用间隙锁。</p>
<h1 id="innodb引擎"><a class="markdownIt-Anchor" href="#innodb引擎">#</a> <mark>InnoDB 引擎</mark></h1>
<h2 id="逻辑存储结构"><a class="markdownIt-Anchor" href="#逻辑存储结构">#</a> 逻辑存储结构</h2>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305151521186.png" alt="image-20230515152114999"></p>
<ul>
<li>表空间 (ibd 文件)：一个 mysql 实例可以对应多个表空间，用于存储记录、索引等数据。</li>
</ul>
<p>Linux 系统下，mysql 的文件存放在 /var/lib/mysql 中</p>
<ul>
<li>
<p>段：分为数据段 (Leaf node segment)、索引段 (Non-leaf node segment)、回滚段 (Rollback segment)，InnoDB 是索引组织表，数据段就是 B + 树的叶子节点，索引段即为 B + 树的非叶子节点。段用来管理多个 Extent (区)。</p>
</li>
<li>
<p>区：表空间的单元结构，每个区的大小为 1M。默认情况下，InnoDB 存储引擎页大小为 16K，即一个区中一共有 64 个连续的页。</p>
</li>
<li>
<p>页：是 InnoDB 存储引擎磁盘管理的最小单元，每个页的默认大小为 16KB。为了保证页的连续性，InnoDB 存储引擎每次从磁盘申请 4-5 个区。</p>
</li>
<li>
<p>行：InnoDB 存储引擎数据是按行进行存放的</p>
</li>
</ul>
<h2 id="架构"><a class="markdownIt-Anchor" href="#架构">#</a> 架构</h2>
<p>MySQL5.5 版本开始，默认使用 InnoDB 存储引擎，它擅长事务处理，具有崩溃恢复特性，在日常开发中使用非常广泛。下面是 InnoDB 架构图，左侧为内存结构，右侧为磁盘结构。</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305151607051.png" alt="image-20230515152917476"></p>
<h3 id="内存结构"><a class="markdownIt-Anchor" href="#内存结构">#</a> 内存结构：</h3>
<p>缓冲池：</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305151635469.png" alt="image-20230515162031407"></p>
<p>更改缓冲区 (MySQL5.+ 时为插入缓冲区)</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305151643491.png" alt="image-20230515164344372"></p>
<p>自适应哈希索引：</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305151646205.png" alt="image-20230515164615665"></p>
<p>日志缓冲区：</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305151650171.png" alt="image-20230515165058078"></p>
<h3 id="磁盘结构"><a class="markdownIt-Anchor" href="#磁盘结构">#</a> 磁盘结构：</h3>
<p>系统表空间，独立表空间：</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305151658088.png" alt="image-20230515165558615"></p>
<p>通用表空间，撤销表空间，临时表空间：</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305151700819.png" alt="image-20230515165917557"></p>
<p>双写缓冲区，重做日志：</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305151700555.png" alt="image-20230515170010703"></p>
<h3 id="后台线程"><a class="markdownIt-Anchor" href="#后台线程">#</a> 后台线程</h3>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305151704570.png" alt="image-20230515170400461"></p>
<h2 id="事务原理"><a class="markdownIt-Anchor" href="#事务原理">#</a> 事务原理</h2>
<p>事务是一组操作的集合，它是一个不可分割的工作单位，事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。</p>
<p><mark><strong>事务四大特性：</strong></mark></p>
<p>原子性 (Atomicity)：<strong>事务是不可分割的最小操作单元，要么全部成功，要么全部失败。</strong></p>
<p>一致性 (Consistency)：<strong>事务完成时，必须使所有的数据都保持一直状态。</strong></p>
<p>隔离性 (Isolation)：<strong>数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行。</strong></p>
<p>持久性 (Durability)：<strong>事务一旦提交或回滚，它对数据库中的数据的改变是永久的。</strong></p>
<p>被缩写为：ACID</p>
<h3 id="redo-log"><a class="markdownIt-Anchor" href="#redo-log">#</a> redo log</h3>
<p>重做日志，记录的是事务提交时数据页的物理修改，用来实现事务的持久性。</p>
<p>该日志文件由两部分组成：重做日志缓冲 (redo log buffer) 以及重做日志文件 (redo log file)，前者是在内存中，后者在磁盘中。当事务提交之后，会把所有修改信息都存储到该日志文件中，用于在刷新脏页到磁盘，发生错误时，进行数据恢复使用。</p>
<h3 id="undo-log"><a class="markdownIt-Anchor" href="#undo-log">#</a> undo log</h3>
<p>回滚日志，用于记录数据被修改钱的信息，作用包含两个：提供回滚和 MVCC (多版本并发控制)。</p>
<p>undo log 和 redo log 记录物理日志不一样，它是逻辑日志。</p>
<p>可以认为当 delete 一条记录时，undo log 中会记录一条对应的 insert 记录，反之亦然，当 update 一条记录时，它记录一条对应相反的 update 记录。当执行 rollback 时，就可以从 undo log 中的逻辑记录读取到相应的内容并进行回滚。</p>
<p>Undo log 销毁：undo log 在事务执行时产生，事务提交时，并不会立即删除，因为这些日志还可能用于 MVCC。</p>
<p>Undo log 存储：undo log 采用段的方式进行管理和记录，存放在前面介绍的 rollback segment 回滚段中，内部包含 1024 个 undo log segment。</p>
<h2 id="mvccmulti-version-concurrency-control"><a class="markdownIt-Anchor" href="#mvccmulti-version-concurrency-control">#</a> MVCC(Multi-Version Concurrency Control)</h2>
<h3 id="基本概念"><a class="markdownIt-Anchor" href="#基本概念">#</a> 基本概念</h3>
<p><strong>当前读：</strong></p>
<p>读取的是记录的最新版本，读取时还要保证其他并发事务不能修改当前记录，会对读取的记录进行加锁。</p>
<p>对于日常的操作，如：</p>
<p>select … lock in share mode (共享锁)，select … for update、update、insert、delete (排它锁)</p>
<p>都是一种当前读。</p>
<p><strong>快照读：</strong></p>
<p>简单的 select (不加锁) 就是快照读，读取的时记录数据的可见版本。有可能是历史数据，不加锁，是非阻塞读</p>
<ul>
<li>Read Committed：每次 select，都生成一个快照读</li>
<li>Repeatable Read：开启事务后第一个 select 语句才是快照读的地方</li>
<li>Serializable：快照读会退化为当前读</li>
</ul>
<p><strong>MVCC</strong></p>
<p>全称 Multi-Version Concurrency Control，多版本并发控制。指维护一个数据的多个版本，使得读写操作没有冲突，快照读为 MySQL 实现 MVCC 提供了一个非阻塞读功能。</p>
<p>MVCC 的具体实现，还需要依赖于数据库记录中的<strong>三个隐式字段、undo log 日志、readView</strong></p>
<h3 id="mvcc-隐藏字段"><a class="markdownIt-Anchor" href="#mvcc-隐藏字段">#</a> MVCC - 隐藏字段</h3>
<p>在 InnoDB 引擎中，创建一张表时，除了显示出来的字段外，还会自动创建两个 (三个) 隐藏字段：</p>
<table>
<thead>
<tr>
<th style="text-align:center">隐藏字段</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">DB_TRX_ID</td>
<td style="text-align:center">最近修改事务 ID，记录插入这条记录或最后一次修改该记录的事务 ID</td>
</tr>
<tr>
<td style="text-align:center">DB_ROLL_PTR</td>
<td style="text-align:center">回滚指针，指向这条记录的上一个版本，用于配合 undo log，指向上一个版本</td>
</tr>
<tr>
<td style="text-align:center">DB_ROW_ID</td>
<td style="text-align:center">隐藏主键，如果表结构没有指定主键，将会生成该隐藏字段</td>
</tr>
</tbody>
</table>
<h3 id="undo-log-2"><a class="markdownIt-Anchor" href="#undo-log-2">#</a> undo log</h3>
<p>回滚日志，在 insert、update、delete 的时候产生的便于数据回滚的日志。</p>
<p>当 insert 的时候，产生的 undo log 只在回滚时需要，在事务提交后，可被立即删除。</p>
<p>而 update、delete 的时候，产生的 undo log 不仅在回滚时需要，在快照读时也需要，不会被立即删除。</p>
<p><strong>undo log 版本链</strong></p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305151820199.png" alt="image-20230515182051063"></p>
<h3 id="readview"><a class="markdownIt-Anchor" href="#readview">#</a> readView</h3>
<p>ReadView (读视图) 是快照读 SQL 执行时 MVCC 提取数据的依据，记录并维护系统当前活跃的事务 id。</p>
<p>ReadView 中包含了四个核心字段：</p>
<table>
<thead>
<tr>
<th style="text-align:center">字段</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">m_ids</td>
<td style="text-align:center">当前活跃的事务 ID 集合</td>
</tr>
<tr>
<td style="text-align:center">min_trx_id</td>
<td style="text-align:center">最小活跃事务 ID</td>
</tr>
<tr>
<td style="text-align:center">max_trx_id</td>
<td style="text-align:center">预分配事务 ID，当前最大事务 ID+1 (因为事务 ID 是自增的)</td>
</tr>
<tr>
<td style="text-align:center">creator_trx_id</td>
<td style="text-align:center">ReadView 创建者的事务 ID</td>
</tr>
</tbody>
</table>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305151826538.png" alt="image-20230515182618412"></p>
<h1 id="mysql管理"><a class="markdownIt-Anchor" href="#mysql管理">#</a> MySQL 管理</h1>
<h2 id="系统数据库"><a class="markdownIt-Anchor" href="#系统数据库">#</a> 系统数据库</h2>
<p>MySQL 数据库安装完成后，自带了以下四个数据库，具体作用如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">数据库</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">mysql</td>
<td style="text-align:center">存储 MySQL 服务器正常运行所需要的各种信息 (时区、主从、用户、权限等)</td>
</tr>
<tr>
<td style="text-align:center">information_schema</td>
<td style="text-align:center">提供了访问数据库元数据的各种表和视图，包含数据库、表、字段类型及访问权限等</td>
</tr>
<tr>
<td style="text-align:center">performance_schema</td>
<td style="text-align:center">为 MySQL 服务器运行时状态提供了一个底层监控功能，主要用于收集数据库服务器性能参数</td>
</tr>
<tr>
<td style="text-align:center">sys</td>
<td style="text-align:center">包含一系列方便 DBA 和开发人员利用的 performance_schema 性能数据库进行性能调优和诊断的视图</td>
</tr>
</tbody>
</table>
<h2 id="常用工具"><a class="markdownIt-Anchor" href="#常用工具">#</a> 常用工具</h2>
<h3 id="mysql"><a class="markdownIt-Anchor" href="#mysql">#</a> mysql</h3>
<p>该 mysql 不是指 mysql 服务，而是指 mysql 的客户端工具</p>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql [option] [database]</span><br><span class="line">#option:</span><br><span class="line">-u,--user=name #指定用户名</span><br><span class="line">-p,--password[=name] #指定密码</span><br><span class="line">-h,--host=name #指定服务器ip或域名</span><br><span class="line">-P,--port=port #指定连接端口，这里的P是大写的</span><br><span class="line">-e,--execute=name #执行SQL语句并退出</span><br><span class="line"></span><br><span class="line">#-e选项可以在MySQL客户端执行SQL语句，而不用连接到MySQL数据库再执行。</span><br><span class="line">#对于一些批处理脚本，这种方式尤其方便。</span><br><span class="line">#示例：</span><br><span class="line">mysql -uroot -p123456 db01 -e &quot;select * from stu&quot;;</span><br></pre></td></tr></table></figure>
<h3 id="mysqladmin"><a class="markdownIt-Anchor" href="#mysqladmin">#</a> mysqladmin</h3>
<p>mysqladmin 是一个执行管理操作的客户端程序。</p>
<p>可以用它来检查服务器的配置和当前状态、创建并删除数据库等。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#通过帮助文档查看选项：</span><br><span class="line">mysqladmin --help</span><br><span class="line"></span><br><span class="line">#示例：</span><br><span class="line">mysqladmin -uroot -p123456 drop &#x27;test01&#x27;</span><br><span class="line">mysqladmin -uroot -p123456 version</span><br></pre></td></tr></table></figure>
<h3 id="mysqlbinlog"><a class="markdownIt-Anchor" href="#mysqlbinlog">#</a> mysqlbinlog</h3>
<p>由于服务器生成的二进制日志文件以二进制格式保存，所以如果想要检查这些文本的文本格式，就会使用到 mysqlbinlog 日志管理工具。</p>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [option] log-files1 log-files2 ...</span><br><span class="line"></span><br><span class="line">#option：</span><br><span class="line">-d,--database=name #指定数据库名称，只列出指定的数据库相关操作</span><br><span class="line">-o,--offset=# #忽略掉日志中前n行命令</span><br><span class="line">-r,--result-file=name #将输出的文本格式日志输出到指定文件</span><br><span class="line">-s,--short-form #显示简单格式，省略掉一些信息</span><br><span class="line">--start-datatime=date1 --stop-datatime=date2 #指定日期间隔内的所有日志</span><br><span class="line">--start-position=pos1 --stop-position=pos2 #指定位置间隔内的所有日志</span><br></pre></td></tr></table></figure>
<h3 id="mysqlshow"><a class="markdownIt-Anchor" href="#mysqlshow">#</a> mysqlshow</h3>
<p>mysqlshow 客户端对象查找工具，用来很快的查找存在哪些数据库、数据库中的表、表中的列或者索引。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#语法：</span><br><span class="line">mysqlshow [option] [db_name[table_name[col_name]]]</span><br><span class="line"></span><br><span class="line">#选项：</span><br><span class="line">--count #显示数据库及表的统计信息(数据库，表 均可以不指定)</span><br><span class="line">-i #显示指定数据库或者指定表的状态信息</span><br><span class="line"></span><br><span class="line">#示例：</span><br><span class="line">#查询每个数据库的表的数量及表中记录的数量</span><br><span class="line">mysqlshow -uroot -p123456 --count</span><br><span class="line"></span><br><span class="line">#查询test库中每个表中的字段数及行数</span><br><span class="line">mysqlshow -uroot -p123456 test --count</span><br><span class="line"></span><br><span class="line">#查询test库中book表的详细情况</span><br><span class="line">mysqlshow -uroot -p123456 test book --count</span><br></pre></td></tr></table></figure>
<h3 id="mysqldump"><a class="markdownIt-Anchor" href="#mysqldump">#</a> mysqldump</h3>
<p>mysqldump 客户端工具用来备份数据库或在不同数据库之间进行数据迁移。</p>
<p>备份内容包含建表，及插入表的 SQL 语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#语法：</span><br><span class="line">mysqldump [options] db_name [tables]</span><br><span class="line">mysqldump [options] --database/-B db1 [db2 db3 ...]</span><br><span class="line">mysqldump [options] --all-databases/-A</span><br><span class="line"></span><br><span class="line">#连接选项：</span><br><span class="line">-u,--user=name #指定用户名</span><br><span class="line">-p,--password[=name] #指定密码</span><br><span class="line">-h,--host=name #指定服务器ip或域名</span><br><span class="line">-P,--port=# #指定连接端口</span><br><span class="line"></span><br><span class="line">#输出选项：</span><br><span class="line">--add-drop-database</span><br><span class="line">--add-drop-table #在每个表创建语句前加上drop table语句，默认开启;</span><br><span class="line">#若要不开启(--skip-add-drop--table)</span><br><span class="line"></span><br><span class="line">-n,--no-create-db #不包含数据库的创建语句</span><br><span class="line">-t,--no-create-info #不包含数据表的创建语句</span><br><span class="line">-d,--no-data #不包含数据</span><br><span class="line">-T,--tab=name #自动生成两个文件：一个.sql文件，创建表结构的语句;一个.txt文件，数据文件</span><br></pre></td></tr></table></figure>
<h3 id="mysqlimportsource"><a class="markdownIt-Anchor" href="#mysqlimportsource">#</a> mysqlimport/source</h3>
<p>mysqlimport 是客户端数据导入工具，用来导入 mysqldump 加 - T 参数后到处的文本 (txt) 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#语法：</span><br><span class="line">mysqlimport [options] db_name textfile1 [textfile2...]</span><br><span class="line">#注意，需要在文件名前使用绝对路径(mysql信任的文件路径)，否则会失败</span><br><span class="line"></span><br><span class="line">#示例：</span><br><span class="line">mysqlimport -uroot -p1234 test /var/lib/mysql-files/file_name.txt</span><br></pre></td></tr></table></figure>
<p>如果需要导入 sql 文件，可以使用 mysql 中的 source 指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /root/xxxx.sql</span><br></pre></td></tr></table></figure>
<h1 id="-分割线-进阶内容到此结束"><a class="markdownIt-Anchor" href="#-分割线-进阶内容到此结束">#</a> ------ 分割线 ------(进阶内容到此结束)</h1>
<h1 id="日志"><a class="markdownIt-Anchor" href="#日志">#</a> 日志</h1>
<h2 id="错误日志"><a class="markdownIt-Anchor" href="#错误日志">#</a> 错误日志</h2>
<p>错误日志是 MySQL 中最重要的日志之一，它记录了当 mysqld 启动和停止时，以及服务器在运行过程中发生任何严重错误时的相关信息。</p>
<p>当数据库出现任何故障导致无法正常使用时，建议首先查看此日志。</p>
<p>该日志是默认开启的，默认存放目录 /var/log/，默认的日志文件名为 mysqld.log，查看日志位置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%log_error%&#x27;;</span><br></pre></td></tr></table></figure>
<h2 id="二进制日志"><a class="markdownIt-Anchor" href="#二进制日志">#</a> 二进制日志</h2>
<p>二进制日志 (BINLOG) 记录了所有的 DDL (数据定义语言) 语句和 DML (数据操纵语言) 语句，但不包含数据查询 (SELECT、SHOW) 语句。</p>
<p>作用：</p>
<ol>
<li>灾难时的数据恢复；</li>
<li>MySQL 的主从复制。</li>
</ol>
<p>在 MySQL8 版本中，默认二进制日志是开启着的，涉及到的参数如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%log_bin%&#x27;;</span><br></pre></td></tr></table></figure>
<p>MySQL 服务器中提供了多种格式来记录二进制日志，具体格式及特点如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">日志格式</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">STATEMENT</td>
<td style="text-align:center">基于 SQL 语句的日志记录，记录的是 SQL 语句，对数据进行修改的 SQL 都会记录在日志文件中</td>
</tr>
<tr>
<td style="text-align:center">ROW</td>
<td style="text-align:center">基于行的日志记录，记录的是每一行的数据变更。(默认)</td>
</tr>
<tr>
<td style="text-align:center">MIXED</td>
<td style="text-align:center">混合了 STATEMENT 和 ROW 两种格式，默认采用 STATEMENT，在某些特殊情况下会自动切换为 ROW 进行记录。</td>
</tr>
</tbody>
</table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%binlog_format%&#x27;;</span><br></pre></td></tr></table></figure>
<p><strong>日志查看：</strong></p>
<p>由于日志是以二进制方式存储的，不能直接读取，需要通过二进制日志查询工具 mysqlbinlog 来查看。</p>
<p>具体语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [option] logfilename</span><br><span class="line"></span><br><span class="line">#option:</span><br><span class="line">-d #指定数据库名称，只列出指定的数据库相关操作</span><br><span class="line">-o #忽略掉日志中的前n行命令</span><br><span class="line">-v #将行事件(数据变更)重构为SQL语句</span><br><span class="line">-vv #将行时间(数据变更)重构为SQL语句，并输出注释信息</span><br></pre></td></tr></table></figure>
<p><strong>日志删除：</strong></p>
<p>对于比较繁忙的业务系统，每天生成的 binlog 数据巨大，如果长时间不清除，将会占用大量的磁盘空间。</p>
<p>可以通过以下几种方式清理日志：</p>
<table>
<thead>
<tr>
<th style="text-align:center">指令</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">reset master</td>
<td style="text-align:center">删除全部 binlog 日志，删除之后，日志编号从 binlog.000001 重新开始</td>
</tr>
<tr>
<td style="text-align:center">purge master logs to ‘binlog.******’</td>
<td style="text-align:center">删除 ****** 编号之前的所有日志</td>
</tr>
<tr>
<td style="text-align:center">purge master logs before ‘yyyy-mm-dd hh:min:ss’</td>
<td style="text-align:center">删除日志为 &quot;yyyy-mm-dd hh:min:ss&quot; 之前产生的所有日志，其中 hh 为 24 小时制</td>
</tr>
</tbody>
</table>
<p>也可以在 mysql 的配置文件中配置二进制日志的过期时间，设置了之后，二进制日志过期会自动删除。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%binlog_expire_logs_seconds%&#x27;;</span><br><span class="line">#该变量的值的单位是秒，默认为30天</span><br></pre></td></tr></table></figure>
<h2 id="查询日志"><a class="markdownIt-Anchor" href="#查询日志">#</a> 查询日志</h2>
<p>查询日志记录了客户端的所有操作语句，而二进制日志不包含查询数据的 SQL 语句。</p>
<p>默认情况下，查询日志是关闭的。通过下面这个语句查询其是否关闭，及其配置文件路径：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%general%&#x27;;</span><br></pre></td></tr></table></figure>
<p>修改 MySQL 的配置文件 /etc/my.cnf 文件，添加如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#该选项用来开启查询日志：</span><br><span class="line">general_log=1</span><br><span class="line">#设置日志的路径和文件名，如果未指定，则默认为host_name.log</span><br><span class="line">general_log_file=/var/lib/mysql/mysql_query.log</span><br></pre></td></tr></table></figure>
<h2 id="慢查询日志-2"><a class="markdownIt-Anchor" href="#慢查询日志-2">#</a> 慢查询日志</h2>
<p>慢查询日志记录了所有执行时间超过参数 long_query_time 设置值并且扫描记录不小于 min_examined_row_limit 的所有的 SQL 语句的日志，默认关闭。</p>
<p>long_query_time 默认为 10 秒，最小为 0，精度可以到微妙。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#慢查询日志</span><br><span class="line">slow_query_log=1</span><br><span class="line">#执行时间参数</span><br><span class="line">long_query_time=2</span><br></pre></td></tr></table></figure>
<p>默认情况下，不会记录管理语句，也不会记录不使用索引进行查找的查询。</p>
<p>可以使用 log_slow_admin_statements 和 log_queries_not_using_indexes 更改此行为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#记录执行较慢的管理语句</span><br><span class="line">log_slow_admin_statements=1</span><br><span class="line">#记录执行较慢的未使用索引的语句</span><br><span class="line">log_queries_not_using_indexes=1</span><br></pre></td></tr></table></figure>
<h1 id="主从复制"><a class="markdownIt-Anchor" href="#主从复制">#</a> 主从复制</h1>
<h2 id="概述-2"><a class="markdownIt-Anchor" href="#概述-2">#</a> 概述</h2>
<p>主从复制是指将主数据库的 DDL 和 DML 操作通过二进制日志传到从库服务器中，然后在从库上对这些日志重新执行 (也叫重做)，从而使得从库和主库的数据保持同步。</p>
<p>MySQL 支持一台主库同时向多台从库进行复制，从库同时也可以作为其他从服务器的主库，实现链状复制。</p>
<p>MySQL 复制的要点主要包含以下三个方面：</p>
<ol>
<li>主库出现问题，可以快速切换到从库提供服务</li>
<li>实现读写分离，降低主库的访问压力</li>
<li>可以在从库中执行备份，以避免备份期间影响主库服务</li>
</ol>
<h2 id="原理"><a class="markdownIt-Anchor" href="#原理">#</a> 原理</h2>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305221644937.png" alt="image-20230522164437823"></p>
<p>从上图来看，复制分成三步：</p>
<ol>
<li>Master 主库在事务提交时，会把数据变更记录在二进制日志文件 Binlog 中</li>
<li>从库读取主库的二进制日志文件 Binlog，写入到从库的中继日志 RelayLog</li>
<li>从库重做中继日志中的事件，将改变反应到它自己的数据</li>
</ol>
<h2 id="搭建"><a class="markdownIt-Anchor" href="#搭建">#</a> 搭建</h2>
<p><strong>服务器准备：</strong></p>
<p>首先需要准备主库与从库两台服务器，并且都安装 mysql 服务，然后开放其 3306 端口 (mysql 服务提供端口)。</p>
<p><strong>主库配置：</strong></p>
<p>1. 修改主库配置文件 /etc/my.cnf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#mysql服务ID，保证整个集群环境中唯一，取值范围：1~2^32-1，默认为1</span><br><span class="line">server-id=1</span><br><span class="line"></span><br><span class="line">#是否只读，1代表只读，0代表读写</span><br><span class="line">read-only=0</span><br><span class="line"></span><br><span class="line">#忽略的数据，指不需要同步的数据库</span><br><span class="line">#binlog-ignore-db=mysql</span><br><span class="line"></span><br><span class="line">#指定同步的数据库</span><br><span class="line">#binlog-do-db=db01</span><br></pre></td></tr></table></figure>
<p>2. 重启 mysql 服务</p>
<p>3. 登录 mysql，创建远程连接的账号，并授予主从复制权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#创建itcast用户，并设置密码，该用户可在任意主机连接该MySQL服务</span><br><span class="line">CREATE USER &#x27;itcast&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;Set_Password&#x27;；</span><br><span class="line"></span><br><span class="line">#为&#x27;itcast&#x27;@&#x27;%&#x27;用户分配主从复制权限</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO &#x27;itcast&#x27;@&#x27;%&#x27;;</span><br></pre></td></tr></table></figure>
<p>4. 通过指令，查看二进制日志坐标</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure>
<p>字段含义说明：</p>
<p>file：从哪个日志文件开始推送日志文件</p>
<p>position：从哪个位置开始推送日志</p>
<p>binlog_ignore_db：指定不需要同步的数据库</p>
<p><strong>从库配置：</strong></p>
<p>1. 修改配置文件 /etc/my.cnf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#mysql服务ID，保证整个集群环境中唯一，取值范围1~2^32-1，和主库不一样即可</span><br><span class="line">server-id=2</span><br><span class="line"></span><br><span class="line">#是否只读，1代表只读，0代表读写</span><br><span class="line">read-only=1</span><br><span class="line">#该参数的只读权限仅作用于普通用户，对于超级管理员无效</span><br><span class="line"></span><br><span class="line">super-read-only=1</span><br><span class="line">#该指令可将超级管理员的权限也修改为仅只读</span><br></pre></td></tr></table></figure>
<p>2. 重启 mysql 服务</p>
<p>3. 登录 mysql，设置主库配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CHANGE REPLICATION SOURCE TO SOURCE_HOST=&#x27;XXX.XXX&#x27;, SOURCE_USER=&#x27;XXX&#x27;, SOURCE_PASSWORD=&#x27;XXX&#x27;, SOURCE_LOG_FILE=&#x27;XXX&#x27;, SOURCE_LOG_POS=XXX;</span><br><span class="line">#该语句为8.0.23版本的语法，如果是之前的版本，执行如下SQL：</span><br><span class="line">CHANGE MASTER TO MASTER_HOST=&#x27;XXX.XXX.XXX.XXX&#x27;, MASTER_USER=&#x27;XXX&#x27;, MASTER_PASSWORD=&#x27;XXX&#x27;, MASTER_LOG_FILE=&#x27;XXX&#x27;, MASTER_LOG_POS=XXX;</span><br></pre></td></tr></table></figure>
<p>4. 开启同步操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start replica;#8.0.22之后</span><br><span class="line">start slave;#8.0.22之前</span><br></pre></td></tr></table></figure>
<p>5. 查看主从同步状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show replica status;#8.0.22之后</span><br><span class="line">show slave status;#8.0.22之前</span><br></pre></td></tr></table></figure>
<h1 id="分库分表"><a class="markdownIt-Anchor" href="#分库分表">#</a> 分库分表</h1>
<p>分库分表的中心思想是将数据分散存储，使得单一数据库 / 表的数据量变小。</p>
<p>以此来缓解单一数据库的性能问题，从而达到提升数据库性能的目的。</p>
<h2 id="拆分策略"><a class="markdownIt-Anchor" href="#拆分策略">#</a> 拆分策略</h2>
<p>有两种拆分策略：垂直拆分、水平拆分</p>
<p><strong>垂直分库：以表为依据，根据业务将不同表拆分到不同库中</strong></p>
<ol>
<li>每个库的表结构都不一样</li>
<li>每个库的数据也不一样</li>
<li>所有库的并集是全量数据</li>
</ol>
<p><strong>垂直分表：以字段为依据，根据字段属性将不同字段拆分到不同表中</strong></p>
<ol>
<li>每个表的结构都不一样</li>
<li>每个表的数据也不一样，一般通过一列 (主键 / 外键) 关联</li>
<li>所有表的并集是全量数据</li>
</ol>
<p>水平分库：以字段为依据，按照一定策略，将一个库的数据拆分到多个库中</p>
<ol>
<li>每个库的表结构都一样</li>
<li>每个库的数据都不一样</li>
<li>所有库的并集是全量数据</li>
</ol>
<p>水平分表：以字段为依据，按照一定策略，将一个表的数据拆分到多个表中</p>
<ol>
<li>每个表的表结构都一样</li>
<li>每个表的数据都不一样</li>
<li>所有表的并集是全量数据</li>
</ol>
<p><strong>实现技术：</strong></p>
<ul>
<li>shardingJDBC：基于 AOP 原理，在应用程序中堆本地执行的 SQL 进行拦截、解析、改写、路由处理。需要自行编码配置实现，只支持 java 语言，性能较高。</li>
<li>MyCat：数据库分库分表中间件，不用调整代码即可实现分库分表，支持多种语言，性能不及前者。</li>
</ul>
<h2 id="mycat"><a class="markdownIt-Anchor" href="#mycat">#</a> MyCat</h2>
<h3 id="mycat基础及部署"><a class="markdownIt-Anchor" href="#mycat基础及部署">#</a> Mycat 基础及部署</h3>
<p>MyCat 是开源的、活跃的、基于 java 语言编写的 MySQL 数据库中间件。</p>
<p>可以向使用 mysql 一样来使用 mycat，对于开发人员来说根本感觉不到 mycat 的存在。</p>
<p>优势：</p>
<ul>
<li>性能可靠稳定</li>
<li>强大的技术团队</li>
<li>体系完善</li>
<li>社区活跃</li>
</ul>
<p><strong>安装</strong></p>
<p>MyCat 是采用 java 语言开发的开源的数据库中间件，支持 Windows 和 Linux 运行环境。</p>
<p>在 Linux 中安装 MyCat 需要在服务器中提前安装如下软件：</p>
<ul>
<li>MySQL</li>
<li>JDK</li>
<li>MyCat</li>
</ul>
<p>安装 JDK：</p>
<p>下载并解压 JDK 压缩包，将其置于指定目录 /usr/local</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf jdk...... -C /usr/local</span><br></pre></td></tr></table></figure>
<p>配置环境变量：</p>
<p>使用 vim 命令修改 /etc/profile 文件，在文件末尾加入如下配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME=/usr/local/jdk....</span><br><span class="line">PATH=$JAVA_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>
<p>安装 MyCat：</p>
<p>下载并解压 MyCat 压缩包，将其置于指定目录 /usr/local</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf Mycat-server-1.6.7.3-release-20210913163959-linux.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure>
<p>MyCat 目录结构：</p>
<ul>
<li>bin：存放可执行文件，用于启动或停止 mycat</li>
<li>conf：存放 mycat 的配置文件</li>
<li>lib：存放 mycat 的项目依赖包 (jar)</li>
<li>logs：存放 mycat 的日志文件</li>
</ul>
<h3 id="mycat概述"><a class="markdownIt-Anchor" href="#mycat概述">#</a> Mycat 概述</h3>
<p>Mycat 并不存储数据，它仅作逻辑分片，数据仍存储在底层的 MySQL 上</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305291546696.png" alt="image-20230529154658572"></p>
<h3 id="mycat入门"><a class="markdownIt-Anchor" href="#mycat入门">#</a> Mycat 入门</h3>
<p><strong>分片配置 (schema.xml)：</strong></p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305291744742.png" alt="image-20230529174439452"></p>
<p>配置示例：</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305291745419.png" alt="image-20230529174503332"></p>
<p><strong>配置 server.xml</strong></p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305291746593.png" alt="image-20230529174609492"></p>
<p>启动服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">切换到Mycat的安装目录，执行如下指令，启动Mycat：</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动</span></span><br><span class="line">bin/mycat start</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止</span></span><br><span class="line">bin/mycat stop</span><br></pre></td></tr></table></figure>
<p>Mycat 启动之后，占用端口号 8066</p>
<h3 id="mycat配置"><a class="markdownIt-Anchor" href="#mycat配置">#</a> Mycat 配置</h3>
<p>schema.xml：配置逻辑库，逻辑表等相关信息</p>
<p>server.xml：配置 mycat 运行的服务相关的信息</p>
<p>rule.xml：配置分片规则的相关信息</p>
<h4 id="schemaxml"><a class="markdownIt-Anchor" href="#schemaxml">#</a> schema.xml</h4>
<p>schema.xml 作为 Mycat 中最重要的配置文件之一，涵盖了 Mycat 的逻辑库、逻辑表、分片规则、分片节点及数据源的配置。</p>
<p>主要包含以下三组标签：</p>
<ul>
<li>schema 标签</li>
<li>datanode 标签</li>
<li>datahost 标签</li>
</ul>
<p><strong>schema 标签：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;DB01&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;true&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span> &gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;TB_ORDER&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1,dn2,dn3&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;auto-sharding-long&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>schema 标签用于定义 Mycat 实例中的逻辑库，一个 Mycat 实例中，可以有多个逻辑库，可以通过 schema 标签来划分不同的逻辑库。</p>
<p>Mycat 中的逻辑库的概念，等同于 MySQL 中的 database 概念，需要操作某个逻辑库下的表时，也需要切换逻辑库 (use xxx)。</p>
<p>核心属性：</p>
<ul>
<li>name：指定自定义的逻辑库库名</li>
<li>checkSQLschema：在 SQL 语句操作时指定了数据库名称，执行时是否自动去除；true 自动去除，false 不自动去除。</li>
<li>sqlMaxLimit：如果未指定 limit 进行查询，列表查询模式查询多少条记录</li>
</ul>
<p><strong>dataNode 标签：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;dhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db01&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn2&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;dhost2&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db01&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn3&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;dhost3&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db01&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>dataNode 标签中定义了 Mycat 中的数据节点，也就是我们通常说的数据分片。</p>
<p>一个 dataNode 标签就是一个独立的数据分片。</p>
<p>核心属性：</p>
<ul>
<li>name：定义数据节点名称</li>
<li>dataHost：数据库实例主机名称，引用自 dataHost 标签中 name 属性</li>
<li>database：定义分片所属数据库</li>
</ul>
<p><strong>dataHost 标签：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;dhost1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;0&quot;</span> <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;jdbc&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;master&quot;</span> <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://192.168.200.210:3306?useSSL=faluse<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>characterEncoding=utf8&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123456&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>该标签在 Mycat 逻辑库中作为底层标签存在，直接定义了具体的数据库实例、读写分离、心跳语句。</p>
<p>核心属性：</p>
<ul>
<li>name：唯一表示，供上层标签使用</li>
<li>maxCon/minCon：最大连接数 / 最小连接数</li>
<li>balance：负载均衡策略，取值 0，1，2，3</li>
<li>writeType：写操作分发方式 (0：写操作转发到第一个 writeHost，第一个挂了，切换到第二个；1：写操作随机分发到配置的 writeHost)</li>
<li>dbDriver：数据库驱动，支持 native、jdbc</li>
</ul>
<h4 id="rulexml"><a class="markdownIt-Anchor" href="#rulexml">#</a> rule.xml</h4>
<p>rule.xml 中定义所有拆分表的规则，在使用过程中可以灵活的使用分片算法，或者对同一个分片算法使用不同的参数，它让分片过程可配置化。</p>
<p>主要包含两类标签：</p>
<ul>
<li>tableRule</li>
<li>Function</li>
</ul>
<h4 id="serverxml"><a class="markdownIt-Anchor" href="#serverxml">#</a> server.xml</h4>
<p>server.xml 配置文件包含了 Mycat 的系统配置信息，主要有两个重要的标签：system、user。</p>
<p><strong>system 标签：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">system</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;nonePasswordLgoin&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useHandshakeV10&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useSql&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">system</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>user 标签：</strong></p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202305291859326.png" alt="image-20230529185949146"></p>
<p>若 privileges check 不做更改，则表示允许所有权限。</p>
<h3 id="mycat分片规则"><a class="markdownIt-Anchor" href="#mycat分片规则">#</a> Mycat 分片规则</h3>
<ul>
<li>分片规则 - 范围：</li>
</ul>
<p>根据指定的字段及配置的范围与数据节点的对应情况，来决定该数据属于哪一个分片。</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202306051237470.png" alt="image-20230605123712301"></p>
<ul>
<li>分片规则 - 取模</li>
</ul>
<p>根据指定的字段值与节点数量进行求模运算，根据运算结果，决定该数据属于哪一个分片。</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202306051239514.png" alt="image-20230605123935430"></p>
<ul>
<li>分片规则 - 一致性 hash</li>
</ul>
<p>所谓一致性 hash，指相同的 hash 因子计算值总是被划分到相同的分区表中，不会因为分区节点的增加而改变原来数据的分区位置。</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202306051241163.png" alt="image-20230605124147060"></p>
<ul>
<li>分片规则 - 枚举</li>
</ul>
<p>通过再配置文件中配置可能的枚举值，指定数据分布到不同的数据节点上，本规则适用于按照省份、性别、状态拆分数据等业务。</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202306051245233.png" alt="image-20230605124548131"></p>
<ul>
<li>分片规则 - 应用指定</li>
</ul>
<p>运行阶段由应用自主决定路由到哪个分片，直接根据字符子串 (必须是数字) 计算分片号。</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202306051329016.png" alt="image-20230605132920909"></p>
<ul>
<li>分片规则 - 固定分片 hash 算法</li>
</ul>
<p>该算法类似于十进制的求模运算，但是为二进制的操作，例如，取 id 的二进制第 10 位与 1111111111 进行位 &amp; 运算。(计算出来的结果必在 0-1023 之间)</p>
<p>特点：</p>
<ol>
<li>如果是求模，连续的值，分别分配到各个不同的分片。但是此算法会将连续的值可能分配到相同的分片，降低事务处理的难度。</li>
<li>可以均匀分配，也可以非均匀分配。</li>
<li>分片字段必须是数字类型。</li>
</ol>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202306051336485.png" alt="image-20230605133633383"></p>
<ul>
<li>分片规则 - 字符串 hash 解析</li>
</ul>
<p>截取字符串中的指定位置的子字符串，进行 hash 算法，算出分片。</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202306051339173.png" alt="image-20230605133945078"></p>
<ul>
<li>分片规则 - 按 (天) 日期分片</li>
</ul>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202306051343281.png" alt="image-20230605134346176"></p>
<ul>
<li>分片规则 - 按月分片</li>
</ul>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202306051345593.png" alt="image-20230605134505489"></p>
<h3 id="mycat的管理及监控"><a class="markdownIt-Anchor" href="#mycat的管理及监控">#</a> Mycat 的管理及监控</h3>
<h4 id="mycat管理"><a class="markdownIt-Anchor" href="#mycat管理">#</a> Mycat 管理：</h4>
<p>Mycat 默认开通 2 个端口，可以再 server.xml 中进行修改。</p>
<ol>
<li>8066 数据访问端口，即进行 DML 和 DDL 操作</li>
<li>9066 数据库管理端口，即 mycat 服务管理控制功能，用于管理 mycat 的整个集群状态</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h ip -P port -u user -p password;</span><br></pre></td></tr></table></figure>
<p>部分基础指令：</p>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">show @@help</td>
<td style="text-align:center">查看 Mycat 管理工具帮助文档</td>
</tr>
<tr>
<td style="text-align:center">show @@version</td>
<td style="text-align:center">查看 Mycat 的版本</td>
</tr>
<tr>
<td style="text-align:center">reload @@config</td>
<td style="text-align:center">重新加载 Mycat 的配置文件</td>
</tr>
<tr>
<td style="text-align:center">show @@datasource</td>
<td style="text-align:center">查看 Mycat 的数据源信息</td>
</tr>
<tr>
<td style="text-align:center">show @@datanode</td>
<td style="text-align:center">查看 Mycat 现有的分片节点信息</td>
</tr>
<tr>
<td style="text-align:center">show @@threadpool</td>
<td style="text-align:center">查看 Mycat 的线程池信息</td>
</tr>
<tr>
<td style="text-align:center">show @@sql</td>
<td style="text-align:center">查看执行的 SQL</td>
</tr>
<tr>
<td style="text-align:center">show @@sql.sum</td>
<td style="text-align:center">查看执行的 SQL 统计</td>
</tr>
</tbody>
</table>
<h4 id="mycat-eye"><a class="markdownIt-Anchor" href="#mycat-eye">#</a> Mycat-eye</h4>
<p>Mycat-web (Mycat-eye) 是对 mycat-server 提供的监控服务，功能不局限于对 mycat-server 使用。</p>
<p>它通过 JDBC 连接对 Mycat、Mysql 监控，监控远程服务器 (目前仅限于 linux 系统) 的 CPU、内存、网络、磁盘。</p>
<p>Mycat-eye 运行过程中需要依赖 zookeeper，因此需要先安装 zookeeper。</p>
<h1 id="读写分离"><a class="markdownIt-Anchor" href="#读写分离">#</a> 读写分离</h1>
<p>读写分离，简单的说是把对数据库的读和写操作分开，以应对不同的数据库服务器。</p>
<p>主数据库提供写操作，从数据库提供读操作，这样能有效的减轻单台数据库的压力。</p>
<p>通过 Mycat 可以轻易实现上述功能，不仅支持 Mysql，也支持 Oracle 和 Sql Server。</p>
<h2 id="一主一从"><a class="markdownIt-Anchor" href="#一主一从">#</a> 一主一从</h2>
<p>Mycat 配置：</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202306051424450.png" alt="image-20230605142407341"></p>
<p>关于 balance：</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202306051424794.png" alt="image-20230605142440690"></p>
<h2 id="双主双从"><a class="markdownIt-Anchor" href="#双主双从">#</a> 双主双从</h2>
<p>Mycat 配置：</p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202306051435414.png" alt="image-20230605143506281"></p>
<p><img src="https://raw.githubusercontent.com/Ailzr/picBed/master/202306051436533.png" alt="image-20230605143617423"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://www.ailzr.com">Ailzr</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.ailzr.com/2023/03/31/MySQL/">https://www.ailzr.com/2023/03/31/MySQL/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.ailzr.com" target="_blank">Ailzr's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="/assets/MySQL_Cover.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/03/31/Docker/" title="Docker"><img class="cover" src="/assets/DockerCover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Docker</div></div></a></div><div class="next-post pull-right"><a href="/2023/02/26/java/" title="Java笔记"><img class="cover" src="/assets/javaCover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Java笔记</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Ailzr</div><div class="author-info__description">我有时会想,在这里写点什么好呢</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Ailzr"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Ailzr" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:ailzr@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">搭了一个chatGPT的网站：用不了一点，apikey给干欠费了。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#mysql%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text"> MySQL 概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sql%E8%AF%AD%E8%A8%80"><span class="toc-number">2.</span> <span class="toc-text"> SQL 语言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9"><span class="toc-number">2.1.</span> <span class="toc-text"> 基础内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E5%88%86%E7%B1%BB"><span class="toc-number">2.2.</span> <span class="toc-text"> SQL 分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ddl%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80"><span class="toc-number">2.3.</span> <span class="toc-text"> DDL (数据定义语言)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ddl-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">2.3.1.</span> <span class="toc-text"> DDL - 数据库操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.3.2.</span> <span class="toc-text"> 数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ddl-%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.3.3.</span> <span class="toc-text"> DDL - 表查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ddl-%E8%A1%A8%E5%88%9B%E5%BB%BA"><span class="toc-number">2.3.4.</span> <span class="toc-text"> DDL - 表创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ddl-%E8%A1%A8%E4%BF%AE%E6%94%B9"><span class="toc-number">2.3.5.</span> <span class="toc-text"> DDL - 表修改</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dml%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E8%AF%AD%E8%A8%80"><span class="toc-number">2.4.</span> <span class="toc-text"> DML (数据操作语言)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dml-%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="toc-number">2.4.1.</span> <span class="toc-text"> DML - 添加数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dml-%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="toc-number">2.4.2.</span> <span class="toc-text"> DML - 修改数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dml-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">2.4.3.</span> <span class="toc-text"> DML - 删除数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dql%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80"><span class="toc-number">2.5.</span> <span class="toc-text"> DQL (数据查询语言)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dql-%E5%9F%BA%E7%A1%80%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.5.1.</span> <span class="toc-text"> DQL - 基础查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dql-%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.5.2.</span> <span class="toc-text"> DQL - 条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dql-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">2.5.3.</span> <span class="toc-text"> DQL - 聚合函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dql-%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.5.4.</span> <span class="toc-text"> DQL - 分组查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dql-%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.5.5.</span> <span class="toc-text"> DQL - 排序查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dql-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.5.6.</span> <span class="toc-text"> DQL - 分页查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dcl%E6%95%B0%E6%8D%AE%E6%8E%A7%E5%88%B6%E8%AF%AD%E8%A8%80"><span class="toc-number">2.6.</span> <span class="toc-text"> DCL (数据控制语言)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dcl-%E7%AE%A1%E7%90%86%E7%94%A8%E6%88%B7"><span class="toc-number">2.6.1.</span> <span class="toc-text"> DCL - 管理用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dcl-%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="toc-number">2.6.2.</span> <span class="toc-text"> DCL - 权限控制</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mysql%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text"> MySQL 内置函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">3.1.</span> <span class="toc-text"> 字符串函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.</span> <span class="toc-text"> 数值函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.</span> <span class="toc-text"> 日期函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="toc-number">3.4.</span> <span class="toc-text"> 流程函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F"><span class="toc-number">4.</span> <span class="toc-text"> 约束</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">4.1.</span> <span class="toc-text"> 外键约束</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.</span> <span class="toc-text"> 多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E6%A6%82%E8%BF%B0"><span class="toc-number">5.1.</span> <span class="toc-text"> 多表查询概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">5.1.1.</span> <span class="toc-text"> 语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB"><span class="toc-number">5.1.2.</span> <span class="toc-text"> 多表查询分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.</span> <span class="toc-text"> 连接查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-number">5.2.1.</span> <span class="toc-text"> 内连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">5.2.2.</span> <span class="toc-text"> 外连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-number">5.2.3.</span> <span class="toc-text"> 自连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.4.</span> <span class="toc-text"> 联合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.5.</span> <span class="toc-text"> 子查询 (嵌套查询)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">6.</span> <span class="toc-text"> 事务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6"><span class="toc-number">6.1.</span> <span class="toc-text"> 事务控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7"><span class="toc-number">6.2.</span> <span class="toc-text"> 事务的四大特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98"><span class="toc-number">6.3.</span> <span class="toc-text"> 并发事务问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-%E5%88%86%E5%89%B2%E7%BA%BF-%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9%E5%88%B0%E6%AD%A4%E7%BB%93%E6%9D%9F"><span class="toc-number">7.</span> <span class="toc-text"> ------ 分割线 ------(基础内容到此结束)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">8.</span> <span class="toc-text"> 存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%89%B9%E7%82%B9"><span class="toc-number">8.1.</span> <span class="toc-text"> 存储引擎特点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#innodb"><span class="toc-number">8.1.1.</span> <span class="toc-text"> InnoDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#myisam"><span class="toc-number">8.1.2.</span> <span class="toc-text"> MyISAM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#memory"><span class="toc-number">8.1.3.</span> <span class="toc-text"> Memory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9%E5%AF%B9%E6%AF%94"><span class="toc-number">8.1.4.</span> <span class="toc-text"> 特点对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E9%80%89%E5%88%99"><span class="toc-number">8.2.</span> <span class="toc-text"> 存储引擎选则</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">9.</span> <span class="toc-text"> 索引</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">9.1.</span> <span class="toc-text"> 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84"><span class="toc-number">9.2.</span> <span class="toc-text"> 索引结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%86%E7%B1%BB"><span class="toc-number">9.3.</span> <span class="toc-text"> 索引分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%AF%AD%E6%B3%95"><span class="toc-number">9.4.</span> <span class="toc-text"> 索引语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">9.5.</span> <span class="toc-text"> SQL 性能分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sql%E6%89%A7%E8%A1%8C%E9%A2%91%E7%8E%87"><span class="toc-number">9.5.1.</span> <span class="toc-text"> SQL 执行频率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">9.5.2.</span> <span class="toc-text"> 慢查询日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#profile%E8%AF%A6%E6%83%85"><span class="toc-number">9.5.3.</span> <span class="toc-text"> profile 详情</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#explain%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="toc-number">9.5.4.</span> <span class="toc-text"> explain 执行计划</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BD%BF%E7%94%A8"><span class="toc-number">9.6.</span> <span class="toc-text"> 索引使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">9.7.</span> <span class="toc-text"> 索引设计原则</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sql%E4%BC%98%E5%8C%96"><span class="toc-number">10.</span> <span class="toc-text"> SQL 优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#insert%E4%BC%98%E5%8C%96"><span class="toc-number">10.1.</span> <span class="toc-text"> insert 优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AEload"><span class="toc-number">10.2.</span> <span class="toc-text"> 大批量插入数据 (load)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E4%BC%98%E5%8C%96"><span class="toc-number">10.3.</span> <span class="toc-text"> 主键优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#order-by%E4%BC%98%E5%8C%96"><span class="toc-number">10.4.</span> <span class="toc-text"> order by 优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#group-by%E4%BC%98%E5%8C%96"><span class="toc-number">10.5.</span> <span class="toc-text"> group by 优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#limit%E4%BC%98%E5%8C%96"><span class="toc-number">10.6.</span> <span class="toc-text"> limit 优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#count%E4%BC%98%E5%8C%96"><span class="toc-number">10.7.</span> <span class="toc-text"> count 优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#update%E4%BC%98%E5%8C%96"><span class="toc-number">10.8.</span> <span class="toc-text"> update 优化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">11.</span> <span class="toc-text"> 视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">11.1.</span> <span class="toc-text"> 基础</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E6%A3%80%E6%9F%A5%E9%80%89%E9%A1%B9"><span class="toc-number">11.2.</span> <span class="toc-text"> 视图检查选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%8F%8A%E4%BD%9C%E7%94%A8"><span class="toc-number">11.3.</span> <span class="toc-text"> 更新及作用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%B1%BB%E4%BC%BC%E4%BA%8E%E5%87%BD%E6%95%B0"><span class="toc-number">12.</span> <span class="toc-text"> 存储过程 (类似于函数)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-2"><span class="toc-number">12.1.</span> <span class="toc-text"> 语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">12.2.</span> <span class="toc-text"> 变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#if%E8%AF%AD%E5%8F%A5"><span class="toc-number">12.3.</span> <span class="toc-text"> if 语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0"><span class="toc-number">12.4.</span> <span class="toc-text"> 参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#case%E8%AF%AD%E5%8F%A5"><span class="toc-number">12.5.</span> <span class="toc-text"> case 语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AFwhilerepeatloop"><span class="toc-number">12.6.</span> <span class="toc-text"> 循环 (while&#x2F;repeat&#x2F;loop)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87"><span class="toc-number">12.7.</span> <span class="toc-text"> 游标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="toc-number">12.8.</span> <span class="toc-text"> 条件处理程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">12.9.</span> <span class="toc-text"> 存储函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">13.</span> <span class="toc-text"> 触发器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%94%81"><span class="toc-number">14.</span> <span class="toc-text"> 锁</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E9%94%81"><span class="toc-number">14.1.</span> <span class="toc-text"> 全局锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E7%BA%A7%E9%94%81"><span class="toc-number">14.2.</span> <span class="toc-text"> 表级锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E7%BA%A7%E9%94%81"><span class="toc-number">14.3.</span> <span class="toc-text"> 行级锁</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#innodb%E5%BC%95%E6%93%8E"><span class="toc-number">15.</span> <span class="toc-text"> InnoDB 引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">15.1.</span> <span class="toc-text"> 逻辑存储结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84"><span class="toc-number">15.2.</span> <span class="toc-text"> 架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84"><span class="toc-number">15.2.1.</span> <span class="toc-text"> 内存结构：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E7%BB%93%E6%9E%84"><span class="toc-number">15.2.2.</span> <span class="toc-text"> 磁盘结构：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E7%BA%BF%E7%A8%8B"><span class="toc-number">15.2.3.</span> <span class="toc-text"> 后台线程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%8E%9F%E7%90%86"><span class="toc-number">15.3.</span> <span class="toc-text"> 事务原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#redo-log"><span class="toc-number">15.3.1.</span> <span class="toc-text"> redo log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undo-log"><span class="toc-number">15.3.2.</span> <span class="toc-text"> undo log</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mvccmulti-version-concurrency-control"><span class="toc-number">15.4.</span> <span class="toc-text"> MVCC(Multi-Version Concurrency Control)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">15.4.1.</span> <span class="toc-text"> 基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mvcc-%E9%9A%90%E8%97%8F%E5%AD%97%E6%AE%B5"><span class="toc-number">15.4.2.</span> <span class="toc-text"> MVCC - 隐藏字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undo-log-2"><span class="toc-number">15.4.3.</span> <span class="toc-text"> undo log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#readview"><span class="toc-number">15.4.4.</span> <span class="toc-text"> readView</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mysql%E7%AE%A1%E7%90%86"><span class="toc-number">16.</span> <span class="toc-text"> MySQL 管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">16.1.</span> <span class="toc-text"> 系统数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">16.2.</span> <span class="toc-text"> 常用工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql"><span class="toc-number">16.2.1.</span> <span class="toc-text"> mysql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysqladmin"><span class="toc-number">16.2.2.</span> <span class="toc-text"> mysqladmin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysqlbinlog"><span class="toc-number">16.2.3.</span> <span class="toc-text"> mysqlbinlog</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysqlshow"><span class="toc-number">16.2.4.</span> <span class="toc-text"> mysqlshow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysqldump"><span class="toc-number">16.2.5.</span> <span class="toc-text"> mysqldump</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysqlimportsource"><span class="toc-number">16.2.6.</span> <span class="toc-text"> mysqlimport&#x2F;source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-%E5%88%86%E5%89%B2%E7%BA%BF-%E8%BF%9B%E9%98%B6%E5%86%85%E5%AE%B9%E5%88%B0%E6%AD%A4%E7%BB%93%E6%9D%9F"><span class="toc-number">17.</span> <span class="toc-text"> ------ 分割线 ------(进阶内容到此结束)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A5%E5%BF%97"><span class="toc-number">18.</span> <span class="toc-text"> 日志</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="toc-number">18.1.</span> <span class="toc-text"> 错误日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97"><span class="toc-number">18.2.</span> <span class="toc-text"> 二进制日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">18.3.</span> <span class="toc-text"> 查询日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97-2"><span class="toc-number">18.4.</span> <span class="toc-text"> 慢查询日志</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">19.</span> <span class="toc-text"> 主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-2"><span class="toc-number">19.1.</span> <span class="toc-text"> 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">19.2.</span> <span class="toc-text"> 原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA"><span class="toc-number">19.3.</span> <span class="toc-text"> 搭建</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8"><span class="toc-number">20.</span> <span class="toc-text"> 分库分表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%86%E5%88%86%E7%AD%96%E7%95%A5"><span class="toc-number">20.1.</span> <span class="toc-text"> 拆分策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mycat"><span class="toc-number">20.2.</span> <span class="toc-text"> MyCat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mycat%E5%9F%BA%E7%A1%80%E5%8F%8A%E9%83%A8%E7%BD%B2"><span class="toc-number">20.2.1.</span> <span class="toc-text"> Mycat 基础及部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mycat%E6%A6%82%E8%BF%B0"><span class="toc-number">20.2.2.</span> <span class="toc-text"> Mycat 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mycat%E5%85%A5%E9%97%A8"><span class="toc-number">20.2.3.</span> <span class="toc-text"> Mycat 入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mycat%E9%85%8D%E7%BD%AE"><span class="toc-number">20.2.4.</span> <span class="toc-text"> Mycat 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#schemaxml"><span class="toc-number">20.2.4.1.</span> <span class="toc-text"> schema.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rulexml"><span class="toc-number">20.2.4.2.</span> <span class="toc-text"> rule.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#serverxml"><span class="toc-number">20.2.4.3.</span> <span class="toc-text"> server.xml</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mycat%E5%88%86%E7%89%87%E8%A7%84%E5%88%99"><span class="toc-number">20.2.5.</span> <span class="toc-text"> Mycat 分片规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mycat%E7%9A%84%E7%AE%A1%E7%90%86%E5%8F%8A%E7%9B%91%E6%8E%A7"><span class="toc-number">20.2.6.</span> <span class="toc-text"> Mycat 的管理及监控</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mycat%E7%AE%A1%E7%90%86"><span class="toc-number">20.2.6.1.</span> <span class="toc-text"> Mycat 管理：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mycat-eye"><span class="toc-number">20.2.6.2.</span> <span class="toc-text"> Mycat-eye</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-number">21.</span> <span class="toc-text"> 读写分离</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%B8%BB%E4%B8%80%E4%BB%8E"><span class="toc-number">21.1.</span> <span class="toc-text"> 一主一从</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8C%E4%B8%BB%E5%8F%8C%E4%BB%8E"><span class="toc-number">21.2.</span> <span class="toc-text"> 双主双从</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/09/11/go-web/" title="go-web"><img src="/assets/GowebCover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="go-web"/></a><div class="content"><a class="title" href="/2023/09/11/go-web/" title="go-web">go-web</a><time datetime="2023-09-11T12:25:02.000Z" title="发表于 2023-09-11 20:25:02">2023-09-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/02/linux-systemctl/" title="Linux系统设置systemctl自动启动"><img src="/assets/LinuxSystemctlCover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux系统设置systemctl自动启动"/></a><div class="content"><a class="title" href="/2023/09/02/linux-systemctl/" title="Linux系统设置systemctl自动启动">Linux系统设置systemctl自动启动</a><time datetime="2023-09-02T09:38:00.000Z" title="发表于 2023-09-02 17:38:00">2023-09-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/02/Redis/" title="Redis"><img src="/assets/RedisCover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis"/></a><div class="content"><a class="title" href="/2023/09/02/Redis/" title="Redis">Redis</a><time datetime="2023-09-02T07:41:52.000Z" title="发表于 2023-09-02 15:41:52">2023-09-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/15/gin-and-gorm/" title="Gin-and-Gorm"><img src="/assets/Gin-and-Gorm.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Gin-and-Gorm"/></a><div class="content"><a class="title" href="/2023/08/15/gin-and-gorm/" title="Gin-and-Gorm">Gin-and-Gorm</a><time datetime="2023-08-15T12:42:00.000Z" title="发表于 2023-08-15 20:42:00">2023-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/28/GoLearn/" title="Go"><img src="/assets/GoLearn.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go"/></a><div class="content"><a class="title" href="/2023/06/28/GoLearn/" title="Go">Go</a><time datetime="2023-06-28T11:46:13.000Z" title="发表于 2023-06-28 19:46:13">2023-06-28</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By Ailzr</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  function abcjsInit() {
    function abcjsFn() {
      for (let abcContainer of document.getElementsByClassName("abc-music-sheet")) {
        ABCJS.renderAbc(abcContainer, abcContainer.innerHTML, {responsive: 'resize'})
      }
    }
    
    typeof ABCJS === 'object' ? abcjsFn()
      : getScript('https://cdn.jsdelivr.net/npm/abcjs/dist/abcjs-basic-min.min.js').then(abcjsFn)
  }

  window.pjax ? abcjsInit() : document.addEventListener('DOMContentLoaded', abcjsInit)
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'l4Dq9lpMxp11shkV9svLzBv2-gzGzoHsz',
      appKey: 'uPnBcmbPIzZ6IeAr1sH90xCc',
      avatar: 'monsterid',
      serverURLs: 'https://l4dq9lpm.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: true
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>